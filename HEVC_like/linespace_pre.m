% function [b4_enc_fixval, fixed_src, MAE, fix_cnt] = rec_pre(mode, dst, src, Q_fix, color_num)
function [b4_enc_fixval, fixed_src, MAE, fix_cnt] = linespace_pre(mode, dst, src, TH_fix, color_num)
    [SIZE, ~, ~] = size(src);
    fixed_src = src;
    switch SIZE
        case 40
            base_index = [[83:5:120]', 200 + [83:5:120]', 400 + [83:5:120]', 600 + [83:5:120]', 800 + [83:5:120]', 1000 + [83:5:120]', 1200 + [83:5:120]', 1400 + [83:5:120]'];
            % base_left_index = [[83:5:120]', [83:5:120]', 200 + [83:5:120]', 400 + [83:5:120]', 600 + [83:5:120]', 800 + [83:5:120]', 1000 + [83:5:120]', 1200 + [83:5:120]'];
            % base_right_index = [200 + [83:5:120]', 400 + [83:5:120]', 600 + [83:5:120]', 800 + [83:5:120]', 1000 + [83:5:120]', 1200 + [83:5:120]', 1400 + [83:5:120]', 1400 + [83:5:120]'];
            base_down_index = [[88:5:120, 118]', 200 + [88:5:120, 118]', 400 + [88:5:120, 118]', 600 + [88:5:120, 118]', 800 + [88:5:120, 118]', 1000 + [88:5:120, 118]', 1200 + [88:5:120, 118]', 1400 + [88:5:120, 118]'];
            % base_up_index = [[83,83:5:113]', 200 + [83,83:5:113]', 400 + [83,83:5:113]', 600 + [83,83:5:113]', 800 + [83,83:5:113]', 1000 + [83,83:5:113]', 1200 + [83,83:5:113]', 1400 + [83,83:5:113]'];
            index = zeros(8, 8, 24);
            index_ref = index;
            b4_enc_fixval = zeros(8, 8, 24);
            switch mode
                case 1
                    index(:, :, 1) = base_index - SIZE; index_ref(:, :, 1) = base_index;
                    index(:, :, 2) = base_index - 1; index_ref(:, :, 2) = base_index;
                    index(:, :, 3) = base_index + 1; index_ref(:, :, 3) = base_index;
                    index(:, :, 4) = base_index + SIZE; index_ref(:, :, 4) = base_index;
                    index(:, :, 5) = base_index - 2 * SIZE; index_ref(:, :, 5) = index(:, :, 1);
                    index(:, :, 6) = base_index - SIZE - 1; index_ref(:, :, 6) = index(:, :, 2);
                    index(:, :, 7) = base_index - SIZE + 1; index_ref(:, :, 7) = index(:, :, 3);
                    index(:, :, 8) = base_index - 2; index_ref(:, :, 8) = index(:, :, 2);
                    index(:, :, 9) = base_index + 2; index_ref(:, :, 9) = index(:, :, 3);
                    index(:, :, 10) = base_index + SIZE - 1; index_ref(:, :, 10) = index(:, :, 2);
                    index(:, :, 11) = base_index + SIZE + 1; index_ref(:, :, 11) = index(:, :, 3);
                    index(:, :, 12) = base_index + 2 * SIZE; index_ref(:, :, 12) = index(:, :, 4);
                    index(:, :, 13) = base_index - 2 * SIZE - 1; index_ref(:, :, 13) = index(:, :, 6);
                    index(:, :, 14) = base_index - 2 * SIZE + 1; index_ref(:, :, 14) = index(:, :, 7);
                    index(:, :, 15) = base_index - SIZE - 2; index_ref(:, :, 15) = index(:, :, 8);
                    index(:, :, 16) = base_index - SIZE + 2; index_ref(:, :, 16) = index(:, :, 9);
                    index(:, :, 17) = base_index + SIZE - 2; index_ref(:, :, 17) = index(:, :, 8);
                    index(:, :, 18) = base_index + SIZE + 2; index_ref(:, :, 18) = index(:, :, 9);
                    index(:, :, 19) = base_index + 2 * SIZE - 1; index_ref(:, :, 19) = index(:, :, 10);
                    index(:, :, 20) = base_index + 2 * SIZE + 1; index_ref(:, :, 20) = index(:, :, 11);
                    index(:, :, 21) = base_index - 2 * SIZE - 2; index_ref(:, :, 21) = index(:, :, 15);
                    index(:, :, 22) = base_index - 2 * SIZE + 2; index_ref(:, :, 22) = index(:, :, 16);
                    index(:, :, 23) = base_index + 2 * SIZE - 2; index_ref(:, :, 23) = index(:, :, 17);
                    index(:, :, 24) = base_index + 2 * SIZE + 2; index_ref(:, :, 24) = index(:, :, 18);
                case 2
                    index(:, :, 1) = base_index - 2 * SIZE - 1; index_ref(:, :, 1) = base_index;
                    index(:, :, 2) = base_index - SIZE; index_ref(:, :, 2) = base_index;
                    index(:, :, 3) = base_index + SIZE; index_ref(:, :, 3) = base_index;
                    index(:, :, 4) = base_index + 2 * SIZE + 1; index_ref(:, :, 4) = base_index;
                    index(:, :, 5) = base_index - 4 * SIZE - 2; index_ref(:, :, 5) = index(:, :, 1);
                    index(:, 1, 5) = index(:, 1, 5) + 3 * SIZE + 4;
                    index(:, :, 6) = base_index - 3 * SIZE - 1; index_ref(:, :, 6) = index(:, :, 2);
                    index(:, 1, 6) = index(:, 1, 6) + SIZE + 2;
                    index(:, :, 7) = base_index - 2 * SIZE; index_ref(:, :, 7) = index(:, :, 2);
                    index(:, :, 8) = base_index - SIZE - 1; index_ref(:, :, 8) = index(:, :, 3);
                    index(:, :, 9) = base_index + SIZE + 1; index_ref(:, :, 9) = index(:, :, 2);
                    index(:, :, 10) = base_index + 2 * SIZE; index_ref(:, :, 10) = index(:, :, 3);
                    index(:, :, 11) = base_index + 3 * SIZE + 1; index_ref(:, :, 11) = index(:, :, 3);
                    index(:, 8, 11) = index(:, 8, 11) - SIZE - 2;
                    index(:, :, 12) = base_index + 4 * SIZE + 2; index_ref(:, :, 12) = index(:, :, 4);
                    index(:, 8, 12) = index(:, 8, 12) - 3 * SIZE - 4;
                    index(:, :, 13) = base_index - 5 * SIZE - 2; index_ref(:, :, 13) = index(:, :, 6);
                    index(:, 1, 13) = index(:, 1, 13) + 5 * SIZE + 4;
                    index(:, :, 14) = base_index - 4 * SIZE - 1; index_ref(:, :, 14) = index(:, :, 7);
                    index(:, 1, 14) = index(:, 1, 14) + 3 * SIZE + 2;
                    index(:, :, 15) = base_index - 3 * SIZE - 2; index_ref(:, :, 15) = index(:, :, 8);
                    index(:, 1, 15) = index(:, 1, 15) + SIZE + 4;
                    index(:, :, 16) = base_index - 1; index_ref(:, :, 16) = index(:, :, 10);
                    index(:, :, 17) = base_index + 1; index_ref(:, :, 17) = index(:, :, 7);
                    index(:, :, 18) = base_index + 3 * SIZE + 2; index_ref(:, :, 18) = index(:, :, 9);
                    index(:, 8, 18) = index(:, 8, 18) - SIZE - 4;
                    index(:, :, 19) = base_index + 4 * SIZE + 1; index_ref(:, :, 19) = index(:, :, 10);
                    index(:, 8, 19) = index(:, 8, 19) - 3 * SIZE - 2;
                    index(:, :, 20) = base_index + 5 * SIZE + 2; index_ref(:, :, 20) = index(:, :, 11);
                    index(:, 8, 20) = index(:, 8, 20) - 5 * SIZE - 4;
                    index(:, :, 21) = base_index - 6 * SIZE - 2; index_ref(:, :, 21) = index(:, :, 14);
                    index(:, 1, 21) = index(:, 1, 21) + 7 * SIZE + 4;
                    index(:, :, 22) = base_index - 2 * SIZE - 2; index_ref(:, :, 22) = index(:, :, 16);
                    index(:, :, 23) = base_index + 2 * SIZE + 2; index_ref(:, :, 23) = index(:, :, 17);
                    index(:, :, 24) = base_index + 6 * SIZE + 2; index_ref(:, :, 24) = index(:, :, 19);
                    index(:, 8, 24) = index(:, 8, 24) - 7 * SIZE - 4;
                case 3
                    index(:, :, 1) = base_index - SIZE - 1; index_ref(:, :, 1) = base_index;
                    index(:, :, 2) = base_index - SIZE; index_ref(:, :, 2) = base_index;
                    index(:, :, 3) = base_index + SIZE; index_ref(:, :, 3) = base_index;
                    index(:, :, 4) = base_index + SIZE + 1; index_ref(:, :, 4) = base_index;
                    index(:, :, 5) = base_index - 2 * SIZE - 2; index_ref(:, :, 5) = index(:, :, 1);
                    index(:, :, 6) = base_index - 2 * SIZE - 1; index_ref(:, :, 6) = index(:, :, 2);
                    index(:, :, 7) = base_index - 2 * SIZE; index_ref(:, :, 7) = index(:, :, 2);
                    index(:, :, 8) = base_index - 1; index_ref(:, :, 8) = index(:, :, 3);
                    index(:, :, 9) = base_index + 1; index_ref(:, :, 9) = index(:, :, 2);
                    index(:, :, 10) = base_index + 2 * SIZE; index_ref(:, :, 10) = index(:, :, 3);
                    index(:, :, 11) = base_index + 2 * SIZE + 1; index_ref(:, :, 11) = index(:, :, 3);
                    index(:, :, 12) = base_index + 2 * SIZE + 2; index_ref(:, :, 12) = index(:, :, 4);
                    index(:, :, 13) = base_index - 3 * SIZE - 2; index_ref(:, :, 13) = index(:, :, 6);
                    index(:, 1, 13) = index(:, 1, 13) + SIZE + 4;
                    index(:, :, 14) = base_index - 3 * SIZE - 1; index_ref(:, :, 14) = index(:, :, 7);
                    index(:, 1, 14) = index(:, 1, 14) + SIZE + 2;
                    index(:, :, 15) = base_index - SIZE - 2; index_ref(:, :, 15) = index(:, :, 8);
                    index(:, :, 16) = base_index - SIZE + 1; index_ref(:, :, 16) = index(:, :, 7);
                    index(:, :, 17) = base_index + SIZE - 1; index_ref(:, :, 17) = index(:, :, 10);
                    index(:, :, 18) = base_index + SIZE + 2; index_ref(:, :, 18) = index(:, :, 9);
                    index(:, :, 19) = base_index + 3 * SIZE + 1; index_ref(:, :, 19) = index(:, :, 10);
                    index(:, 8, 19) = index(:, 8, 19) - SIZE - 2;
                    index(:, :, 20) = base_index + 3 * SIZE + 2; index_ref(:, :, 20) = index(:, :, 11);
                    index(:, 8, 20) = index(:, 8, 20) - SIZE - 4;
                    index(:, :, 21) = base_index - 4 * SIZE - 2; index_ref(:, :, 21) = index(:, :, 14);
                    index(:, 1, 21) = index(:, 1, 21) + 3 * SIZE + 4;
                    index(:, :, 22) = base_index - 2; index_ref(:, :, 22) = index(:, :, 17);
                    index(:, :, 23) = base_index + 2; index_ref(:, :, 23) = index(:, :, 16);
                    index(:, :, 24) = base_index + 4 * SIZE + 2; index_ref(:, :, 24) = index(:, :, 19);
                    index(:, 8, 24) = index(:, 8, 24) - 3 * SIZE - 4;
                case 4
                    index(:, :, 1) = base_index - SIZE - 1; index_ref(:, :, 1) = base_index;
                    index(:, :, 2) = base_index - 1; index_ref(:, :, 2) = base_index;
                    index(:, :, 3) = base_index + 1; index_ref(:, :, 3) = base_index;
                    index(:, :, 4) = base_index + SIZE + 1; index_ref(:, :, 4) = base_index;
                    index(:, :, 5) = base_index - 2 * SIZE - 2; index_ref(:, :, 5) = index(:, :, 1);
                    index(:, :, 6) = base_index - SIZE - 2; index_ref(:, :, 6) = index(:, :, 2);
                    index(:, :, 7) = base_index - SIZE; index_ref(:, :, 7) = index(:, :, 3);
                    index(:, :, 8) = base_index - 2; index_ref(:, :, 8) = index(:, :, 2);
                    index(:, :, 9) = base_index + 2; index_ref(:, :, 9) = index(:, :, 3);
                    index(:, :, 10) = base_index + SIZE; index_ref(:, :, 10) = index(:, :, 2);
                    index(:, :, 11) = base_index + SIZE + 2; index_ref(:, :, 11) = index(:, :, 3);
                    index(:, :, 12) = base_index + 2 * SIZE + 2; index_ref(:, :, 12) = index(:, :, 4);
                    index(:, :, 13) = base_index - 2 * SIZE - 3; index_ref(:, :, 13) = index(:, :, 6);
                    index(1, :, 13) = index(1, :, 13) + 4 * SIZE + 1;
                    index(:, :, 14) = base_index - 2 * SIZE - 1; index_ref(:, :, 14) = index(:, :, 7);
                    index(:, :, 15) = base_index - SIZE - 3; index_ref(:, :, 15) = index(:, :, 8);
                    index(1, :, 15) = index(1, :, 15) + 2 * SIZE + 1;
                    index(:, :, 16) = base_index - SIZE + 1; index_ref(:, :, 16) = index(:, :, 9);
                    index(:, :, 17) = base_index + SIZE - 1; index_ref(:, :, 17) = index(:, :, 8);
                    index(:, :, 18) = base_index + SIZE + 3; index_ref(:, :, 18) = index(:, :, 9);
                    index(8, :, 18) = index(8, :, 18) - 2 * SIZE - 1;
                    index(:, :, 19) = base_index + 2 * SIZE + 1; index_ref(:, :, 19) = index(:, :, 10);
                    index(:, :, 20) = base_index + 2 * SIZE + 3; index_ref(:, :, 20) = index(:, :, 11);
                    index(8, :, 20) = index(8, :, 20) - 4 * SIZE - 1;
                    index(:, :, 21) = base_index - 2 * SIZE - 4; index_ref(:, :, 21) = index(:, :, 15);
                    index(1, :, 21) = index(1, :, 21) + 4 * SIZE + 3;
                    index(:, :, 22) = base_index - 2 * SIZE; index_ref(:, :, 22) = index(:, :, 16);
                    index(:, :, 23) = base_index + 2 * SIZE; index_ref(:, :, 23) = index(:, :, 17);
                    index(:, :, 24) = base_index + 2 * SIZE + 4; index_ref(:, :, 24) = index(:, :, 18);
                    index(8, :, 24) = index(8, :, 24) - 4 * SIZE - 3;
                case 5
                    index(:, :, 1) = base_index - SIZE - 2; index_ref(:, :, 1) = base_index;
                    index(:, :, 2) = base_index - 1; index_ref(:, :, 2) = base_index;
                    index(:, :, 3) = base_index + 1; index_ref(:, :, 3) = base_index;
                    index(:, :, 4) = base_index + SIZE + 2; index_ref(:, :, 4) = base_index;
                    index(:, :, 5) = base_index - 2 * SIZE - 4; index_ref(:, :, 5) = index(:, :, 1);
                    index(1, :, 5) = index(1, :, 5) + 4 * SIZE + 3;
                    index(:, :, 6) = base_index - SIZE - 3; index_ref(:, :, 6) = index(:, :, 2);
                    index(1, :, 6) = index(1, :, 6) + 2 * SIZE + 1;
                    index(:, :, 7) = base_index - SIZE - 1; index_ref(:, :, 7) = index(:, :, 3);
                    index(:, :, 8) = base_index - 2; index_ref(:, :, 8) = index(:, :, 2);
                    index(:, :, 9) = base_index + 2; index_ref(:, :, 9) = index(:, :, 3);
                    index(:, :, 10) = base_index + SIZE + 1; index_ref(:, :, 10) = index(:, :, 2);
                    index(:, :, 11) = base_index + SIZE + 3; index_ref(:, :, 11) = index(:, :, 3);
                    index(8, :, 11) = index(8, :, 11) - 2 * SIZE - 1;
                    index(:, :, 12) = base_index + 2 * SIZE + 4; index_ref(:, :, 12) = index(:, :, 4);
                    index(8, :, 12) = index(8, :, 12) - 4 * SIZE - 3;
                    index(:, :, 13) = base_index - 2 * SIZE - 5; index_ref(:, :, 13) = index(:, :, 6);
                    index(1, :, 13) = index(1, :, 13) + 4 * SIZE + 5;
                    index(:, :, 14) = base_index - 2 * SIZE - 3; index_ref(:, :, 14) = index(:, :, 7);
                    index(1, :, 14) = index(1, :, 14) + 4 * SIZE + 1;
                    index(:, :, 15) = base_index - SIZE - 4; index_ref(:, :, 15) = index(:, :, 8);
                    index(1, :, 15) = index(1, :, 15) + 2 * SIZE + 3;
                    index(:, :, 16) = base_index - SIZE; index_ref(:, :, 16) = index(:, :, 9);
                    index(:, :, 17) = base_index + SIZE; index_ref(:, :, 17) = index(:, :, 8);
                    index(:, :, 18) = base_index + SIZE + 4; index_ref(:, :, 18) = index(:, :, 9);
                    index(8, :, 18) = index(8, :, 18) - 2 * SIZE - 3;
                    index(:, :, 19) = base_index + 2 * SIZE + 3; index_ref(:, :, 19) = index(:, :, 10);
                    index(8, :, 19) = index(8, :, 19) - 4 * SIZE - 1;
                    index(:, :, 20) = base_index + 2 * SIZE + 5; index_ref(:, :, 20) = index(:, :, 11);
                    index(8, :, 20) = index(8, :, 20) - 4 * SIZE - 5;
                    index(:, :, 21) = base_index - 2 * SIZE - 6; index_ref(:, :, 21) = index(:, :, 15);
                    index(1, :, 21) = index(1, :, 21) + 4 * SIZE + 7;
                    index(:, :, 22) = base_index - 2 * SIZE - 2; index_ref(:, :, 22) = index(:, :, 16);
                    index(:, :, 23) = base_index + 2 * SIZE + 2; index_ref(:, :, 23) = index(:, :, 17);
                    index(:, :, 24) = base_index + 2 * SIZE + 6; index_ref(:, :, 24) = index(:, :, 18);
                    index(8, :, 24) = index(8, :, 24) - 4 * SIZE - 7;
                case 6
                    index(:, :, 1) = base_index - SIZE; index_ref(:, :, 1) = base_index;
                    index(:, :, 2) = base_index - 1; index_ref(:, :, 2) = base_index;
                    index(:, :, 3) = base_index + 1; index_ref(:, :, 3) = base_index;
                    index(:, :, 4) = base_index + SIZE; index_ref(:, :, 4) = base_index;
                    index(:, :, 5) = base_index - 2 * SIZE; index_ref(:, :, 5) = index(:, :, 1);
                    index(:, :, 6) = base_index - SIZE - 1; index_ref(:, :, 6) = index(:, :, 1);
                    index(:, :, 7) = base_index - SIZE + 1; index_ref(:, :, 7) = index(:, :, 1);
                    index(:, :, 8) = base_index - 2; index_ref(:, :, 8) = index(:, :, 2);
                    index(:, :, 9) = base_index + 2; index_ref(:, :, 9) = index(:, :, 3);
                    index(:, :, 10) = base_index + SIZE - 1; index_ref(:, :, 10) = index(:, :, 4);
                    index(:, :, 11) = base_index + SIZE + 1; index_ref(:, :, 11) = index(:, :, 4);
                    index(:, :, 12) = base_index + 2 * SIZE; index_ref(:, :, 12) = index(:, :, 4);
                    index(:, :, 13) = base_index - 2 * SIZE - 1; index_ref(:, :, 13) = index(:, :, 5);
                    index(:, :, 14) = base_index - 2 * SIZE + 1; index_ref(:, :, 14) = index(:, :, 5);
                    index(:, :, 15) = base_index - SIZE - 2; index_ref(:, :, 15) = index(:, :, 6);
                    index(:, :, 16) = base_index - SIZE + 2; index_ref(:, :, 16) = index(:, :, 7);
                    index(:, :, 17) = base_index + SIZE - 2; index_ref(:, :, 17) = index(:, :, 10);
                    index(:, :, 18) = base_index + SIZE + 2; index_ref(:, :, 18) = index(:, :, 11);
                    index(:, :, 19) = base_index + 2 * SIZE - 1; index_ref(:, :, 19) = index(:, :, 12);
                    index(:, :, 20) = base_index + 2 * SIZE + 1; index_ref(:, :, 20) = index(:, :, 12);
                    index(:, :, 21) = base_index - 2 * SIZE - 2; index_ref(:, :, 21) = index(:, :, 13);
                    index(:, :, 22) = base_index - 2 * SIZE + 2; index_ref(:, :, 22) = index(:, :, 14);
                    index(:, :, 23) = base_index + 2 * SIZE - 2; index_ref(:, :, 23) = index(:, :, 19);
                    index(:, :, 24) = base_index + 2 * SIZE + 2; index_ref(:, :, 24) = index(:, :, 20);
                case 7
                    index(:, :, 1) = base_index - SIZE + 2; index_ref(:, :, 1) = base_index;
                    index(:, :, 2) = base_index - 1; index_ref(:, :, 2) = base_index;
                    index(:, :, 3) = base_index + 1; index_ref(:, :, 3) = base_index;
                    index(:, :, 4) = base_index + SIZE - 2; index_ref(:, :, 4) = base_index;
                    index(:, :, 5) = base_index - 2 * SIZE + 4; index_ref(:, :, 5) = index(:, :, 1);
                    index(8, :, 5) = index(8, :, 5) + 4 * SIZE - 3;
                    index(:, :, 6) = base_index - SIZE + 1; index_ref(:, :, 6) = index(:, :, 2);
                    index(:, :, 7) = base_index - SIZE + 3; index_ref(:, :, 7) = index(:, :, 3);
                    index(8, :, 7) = index(8, :, 7) + 2 * SIZE - 1;
                    index(:, :, 8) = base_index - 2; index_ref(:, :, 8) = index(:, :, 2);
                    index(:, :, 9) = base_index + 2; index_ref(:, :, 9) = index(:, :, 3);
                    index(:, :, 10) = base_index + SIZE - 3; index_ref(:, :, 10) = index(:, :, 2);
                    index(1, :, 10) = index(1, :, 10) - 2 * SIZE + 1;
                    index(:, :, 11) = base_index + SIZE - 1; index_ref(:, :, 11) = index(:, :, 3);
                    index(:, :, 12) = base_index + 2 * SIZE - 4; index_ref(:, :, 12) = index(:, :, 4);
                    index(1, :, 12) = index(1, :, 12) - 4 * SIZE + 3;
                    index(:, :, 13) = base_index - 2 * SIZE + 3; index_ref(:, :, 13) = index(:, :, 6);
                    index(8, :, 13) = index(8, :, 13) + 4 * SIZE - 1;
                    index(:, :, 14) = base_index - 2 * SIZE + 5; index_ref(:, :, 14) = index(:, :, 7);
                    index(8, :, 14) = index(8, :, 14) + 4 * SIZE - 5;
                    index(:, :, 15) = base_index - SIZE; index_ref(:, :, 15) = index(:, :, 8);
                    index(:, :, 16) = base_index - SIZE + 4; index_ref(:, :, 16) = index(:, :, 9);
                    index(8, :, 16) = index(8, :, 16) + 2 * SIZE - 3;
                    index(:, :, 17) = base_index + SIZE - 4; index_ref(:, :, 17) = index(:, :, 8);
                    index(1, :, 17) = index(1, :, 17) - 2 * SIZE + 3;
                    index(:, :, 18) = base_index + SIZE; index_ref(:, :, 18) = index(:, :, 9);
                    index(:, :, 19) = base_index + 2 * SIZE - 5; index_ref(:, :, 19) = index(:, :, 10);
                    index(1, :, 19) = index(1, :, 19) - 4 * SIZE + 5;
                    index(:, :, 20) = base_index + 2 * SIZE - 3; index_ref(:, :, 20) = index(:, :, 11);
                    index(1, :, 20) = index(1, :, 20) - 4 * SIZE + 1;
                    index(:, :, 21) = base_index - 2 * SIZE + 2; index_ref(:, :, 21) = index(:, :, 15);
                    index(:, :, 22) = base_index - 2 * SIZE + 6; index_ref(:, :, 22) = index(:, :, 16);
                    index(8, :, 22) = index(8, :, 22) + 4 * SIZE - 7;
                    index(:, :, 23) = base_index + 2 * SIZE - 6; index_ref(:, :, 23) = index(:, :, 17);
                    index(1, :, 23) = index(1, :, 23) - 4 * SIZE + 7;
                    index(:, :, 24) = base_index + 2 * SIZE - 2; index_ref(:, :, 24) = index(:, :, 18);
                case 8
                    index(:, :, 1) = base_index - SIZE; index_ref(:, :, 1) = base_index;
                    index(:, :, 2) = base_index - SIZE + 1; index_ref(:, :, 2) = base_index;
                    index(:, :, 3) = base_index + SIZE - 1; index_ref(:, :, 3) = base_index;
                    index(:, :, 4) = base_index + SIZE; index_ref(:, :, 4) = base_index;
                    index(:, :, 5) = base_index - 2 * SIZE; index_ref(:, :, 5) = index(:, :, 1);
                    index(:, :, 6) = base_index - 2 * SIZE + 1; index_ref(:, :, 6) = index(:, :, 1);
                    index(:, :, 7) = base_index - 2 * SIZE + 2; index_ref(:, :, 7) = index(:, :, 2);
                    index(:, :, 8) = base_index - 1; index_ref(:, :, 8) = index(:, :, 1);
                    index(:, :, 9) = base_index + 1; index_ref(:, :, 9) = index(:, :, 4);
                    index(:, :, 10) = base_index + 2 * SIZE - 2; index_ref(:, :, 10) = index(:, :, 3);
                    index(:, :, 11) = base_index + 2 * SIZE - 1; index_ref(:, :, 11) = index(:, :, 4);
                    index(:, :, 12) = base_index + 2 * SIZE; index_ref(:, :, 12) = index(:, :, 4);
                    index(:, :, 13) = base_index - 3 * SIZE + 1; index_ref(:, :, 13) = index(:, :, 5);
                    index(:, 1, 13) = index(:, 1, 13) + SIZE - 2;
                    index(:, :, 14) = base_index - 3 * SIZE + 2; index_ref(:, :, 14) = index(:, :, 6);
                    index(:, 1, 14) = index(:, 1, 14) + SIZE - 4;
                    index(:, :, 15) = base_index - SIZE - 1; index_ref(:, :, 15) = index(:, :, 5);
                    index(:, :, 16) = base_index - SIZE + 2; index_ref(:, :, 16) = index(:, :, 9);
                    index(:, :, 17) = base_index + SIZE - 2; index_ref(:, :, 17) = index(:, :, 8);
                    index(:, :, 18) = base_index + SIZE + 1; index_ref(:, :, 18) = index(:, :, 12);
                    index(:, :, 19) = base_index + 3 * SIZE - 2; index_ref(:, :, 19) = index(:, :, 11);
                    index(:, 8, 19) = index(:, 8, 19) - SIZE + 4;
                    index(:, :, 20) = base_index + 3 * SIZE - 1; index_ref(:, :, 20) = index(:, :, 12);
                    index(:, 8, 20) = index(:, 8, 20) - SIZE + 2;
                    index(:, :, 21) = base_index - 4 * SIZE + 2; index_ref(:, :, 21) = index(:, :, 13);
                    index(:, 1, 21) = index(:, 1, 21) + 3 * SIZE - 4;
                    index(:, :, 22) = base_index - 2; index_ref(:, :, 22) = index(:, :, 15);
                    index(:, :, 23) = base_index + 2; index_ref(:, :, 23) = index(:, :, 18);
                    index(:, :, 24) = base_index + 4 * SIZE - 2; index_ref(:, :, 24) = index(:, :, 20);
                    index(:, 8, 24) = index(:, 8, 24) - 3 * SIZE + 4;
                case 9
                    index(:, :, 1) = base_index - SIZE + 1; index_ref(:, :, 1) = base_index;
                    index(:, :, 2) = base_index - 1; index_ref(:, :, 2) = base_index;
                    index(:, :, 3) = base_index + 1; index_ref(:, :, 3) = base_index;
                    index(:, :, 4) = base_index + SIZE - 1; index_ref(:, :, 4) = base_index;
                    index(:, :, 5) = base_index - 2 * SIZE + 2; index_ref(:, :, 5) = index(:, :, 1);
                    index(:, :, 6) = base_index - SIZE; index_ref(:, :, 6) = index(:, :, 2);
                    index(:, :, 7) = base_index - SIZE + 2; index_ref(:, :, 7) = index(:, :, 3);
                    index(:, :, 8) = base_index - 2; index_ref(:, :, 8) = index(:, :, 2);
                    index(:, :, 9) = base_index + 2; index_ref(:, :, 9) = index(:, :, 3);
                    index(:, :, 10) = base_index + SIZE - 2; index_ref(:, :, 10) = index(:, :, 2);
                    index(:, :, 11) = base_index + SIZE; index_ref(:, :, 11) = index(:, :, 3);
                    index(:, :, 12) = base_index + 2 * SIZE - 2; index_ref(:, :, 12) = index(:, :, 4);
                    index(:, :, 13) = base_index - 2 * SIZE + 1; index_ref(:, :, 13) = index(:, :, 6);
                    index(:, :, 14) = base_index - 2 * SIZE + 3; index_ref(:, :, 14) = index(:, :, 7);
                    index(8, :, 14) = index(8, :, 14) + 4 * SIZE - 1;
                    index(:, :, 15) = base_index - SIZE - 1; index_ref(:, :, 15) = index(:, :, 8);
                    index(:, :, 16) = base_index - SIZE + 3; index_ref(:, :, 16) = index(:, :, 9);
                    index(8, :, 16) = index(8, :, 16) + 2 * SIZE - 1;
                    index(:, :, 17) = base_index + SIZE - 3; index_ref(:, :, 17) = index(:, :, 8);
                    index(1, :, 17) = index(1, :, 17) - 2 * SIZE + 1;
                    index(:, :, 18) = base_index + SIZE + 1; index_ref(:, :, 18) = index(:, :, 9);
                    index(:, :, 19) = base_index + 2 * SIZE - 3; index_ref(:, :, 19) = index(:, :, 10);
                    index(1, :, 19) = index(1, :, 19) - 4 * SIZE + 1;
                    index(:, :, 20) = base_index + 2 * SIZE - 1; index_ref(:, :, 20) = index(:, :, 11);
                    index(:, :, 21) = base_index - 2 * SIZE; index_ref(:, :, 21) = index(:, :, 15);
                    index(:, :, 22) = base_index - 2 * SIZE + 4; index_ref(:, :, 22) = index(:, :, 16);
                    index(8, :, 22) = index(8, :, 22) + 4 * SIZE - 3;
                    index(:, :, 23) = base_index + 2 * SIZE - 4; index_ref(:, :, 23) = index(:, :, 17);
                    index(1, :, 23) = index(1, :, 23) - 4 * SIZE + 3;
                    index(:, :, 24) = base_index + 2 * SIZE; index_ref(:, :, 24) = index(:, :, 18);
                case 10
                    index(:, :, 1) = base_index - 2 * SIZE + 1; index_ref(:, :, 1) = base_index;
                    index(:, :, 2) = base_index - SIZE; index_ref(:, :, 2) = base_index;
                    index(:, :, 3) = base_index + SIZE; index_ref(:, :, 3) = base_index;
                    index(:, :, 4) = base_index + 2 * SIZE - 1; index_ref(:, :, 4) = base_index;
                    index(:, :, 5) = base_index - 4 * SIZE + 2; index_ref(:, :, 5) = index(:, :, 1);
                    index(:, 1, 5) = index(:, 1, 5) + 3 * SIZE - 4;
                    index(:, :, 6) = base_index - 3 * SIZE + 1; index_ref(:, :, 6) = index(:, :, 2);
                    index(:, 1, 6) = index(:, 1, 6) + SIZE - 2;
                    index(:, :, 7) = base_index - 2 * SIZE; index_ref(:, :, 7) = index(:, :, 2);
                    index(:, :, 8) = base_index - SIZE + 1; index_ref(:, :, 8) = index(:, :, 3);
                    index(:, :, 9) = base_index + SIZE - 1; index_ref(:, :, 9) = index(:, :, 2);
                    index(:, :, 10) = base_index + 2 * SIZE; index_ref(:, :, 10) = index(:, :, 3);
                    index(:, :, 11) = base_index + 3 * SIZE - 1; index_ref(:, :, 11) = index(:, :, 3);
                    index(:, 8, 11) = index(:, 8, 11) - SIZE + 2;
                    index(:, :, 12) = base_index + 4 * SIZE - 2; index_ref(:, :, 12) = index(:, :, 4);
                    index(:, 8, 12) = index(:, 8, 12) - 3 * SIZE + 4;
                    index(:, :, 13) = base_index - 5 * SIZE + 2; index_ref(:, :, 13) = index(:, :, 6);
                    index(:, 1, 13) = index(:, 1, 13) + 5 * SIZE - 4;
                    index(:, :, 14) = base_index - 4 * SIZE + 1; index_ref(:, :, 14) = index(:, :, 7);
                    index(:, 1, 14) = index(:, 1, 14) + 3 * SIZE - 2;
                    index(:, :, 15) = base_index - 3 * SIZE + 2; index_ref(:, :, 15) = index(:, :, 8);
                    index(:, 1, 15) = index(:, 1, 15) + SIZE - 4;
                    index(:, :, 16) = base_index - 1; index_ref(:, :, 16) = index(:, :, 7);
                    index(:, :, 17) = base_index + 1; index_ref(:, :, 17) = index(:, :, 10);
                    index(:, :, 18) = base_index + 3 * SIZE - 2; index_ref(:, :, 18) = index(:, :, 9);
                    index(:, 8, 18) = index(:, 8, 18) - SIZE + 4;
                    index(:, :, 19) = base_index + 4 * SIZE - 1; index_ref(:, :, 19) = index(:, :, 10);
                    index(:, 8, 19) = index(:, 8, 19) - 3 * SIZE + 2;
                    index(:, :, 20) = base_index + 5 * SIZE - 2; index_ref(:, :, 20) = index(:, :, 11);
                    index(:, 8, 20) = index(:, 8, 20) - 5 * SIZE + 4;
                    index(:, :, 21) = base_index - 6 * SIZE + 2; index_ref(:, :, 21) = index(:, :, 14);
                    index(:, 1, 21) = index(:, 1, 21) + 7 * SIZE - 4;
                    index(:, :, 22) = base_index - 2 * SIZE + 2; index_ref(:, :, 22) = index(:, :, 17);
                    index(:, :, 23) = base_index + 2 * SIZE - 2; index_ref(:, :, 23) = index(:, :, 16);
                    index(:, :, 24) = base_index + 6 * SIZE - 2; index_ref(:, :, 24) = index(:, :, 19);
                    index(:, 8, 24) = index(:, 8, 24) - 7 * SIZE + 4;
            end
        case 20
            base_index = [[43:5:60]', 100 + [43:5:60]', 200 + [43:5:60]', 300 + [43:5:60]'];
            index = zeros(4, 4, 24);
            index_ref = index;
            b4_enc_fixval = zeros(4, 4, 24);
            switch mode
                case 1
                    index(:, :, 1) = base_index - SIZE; index_ref(:, :, 1) = base_index;
                    index(:, :, 2) = base_index - 1; index_ref(:, :, 2) = base_index;
                    index(:, :, 3) = base_index + 1; index_ref(:, :, 3) = base_index;
                    index(:, :, 4) = base_index + SIZE; index_ref(:, :, 4) = base_index;
                    index(:, :, 5) = base_index - 2 * SIZE; index_ref(:, :, 5) = index(:, :, 1);
                    index(:, :, 6) = base_index - SIZE - 1; index_ref(:, :, 6) = index(:, :, 2);
                    index(:, :, 7) = base_index - SIZE + 1; index_ref(:, :, 7) = index(:, :, 3);
                    index(:, :, 8) = base_index - 2; index_ref(:, :, 8) = index(:, :, 2);
                    index(:, :, 9) = base_index + 2; index_ref(:, :, 9) = index(:, :, 3);
                    index(:, :, 10) = base_index + SIZE - 1; index_ref(:, :, 10) = index(:, :, 2);
                    index(:, :, 11) = base_index + SIZE + 1; index_ref(:, :, 11) = index(:, :, 3);
                    index(:, :, 12) = base_index + 2 * SIZE; index_ref(:, :, 12) = index(:, :, 4);
                    index(:, :, 13) = base_index - 2 * SIZE - 1; index_ref(:, :, 13) = index(:, :, 6);
                    index(:, :, 14) = base_index - 2 * SIZE + 1; index_ref(:, :, 14) = index(:, :, 7);
                    index(:, :, 15) = base_index - SIZE - 2; index_ref(:, :, 15) = index(:, :, 8);
                    index(:, :, 16) = base_index - SIZE + 2; index_ref(:, :, 16) = index(:, :, 9);
                    index(:, :, 17) = base_index + SIZE - 2; index_ref(:, :, 17) = index(:, :, 8);
                    index(:, :, 18) = base_index + SIZE + 2; index_ref(:, :, 18) = index(:, :, 9);
                    index(:, :, 19) = base_index + 2 * SIZE - 1; index_ref(:, :, 19) = index(:, :, 10);
                    index(:, :, 20) = base_index + 2 * SIZE + 1; index_ref(:, :, 20) = index(:, :, 11);
                    index(:, :, 21) = base_index - 2 * SIZE - 2; index_ref(:, :, 21) = index(:, :, 15);
                    index(:, :, 22) = base_index - 2 * SIZE + 2; index_ref(:, :, 22) = index(:, :, 16);
                    index(:, :, 23) = base_index + 2 * SIZE - 2; index_ref(:, :, 23) = index(:, :, 17);
                    index(:, :, 24) = base_index + 2 * SIZE + 2; index_ref(:, :, 24) = index(:, :, 18);
                case 2
                    index(:, :, 1) = base_index - 2 * SIZE - 1; index_ref(:, :, 1) = base_index;
                    index(:, :, 2) = base_index - SIZE; index_ref(:, :, 2) = base_index;
                    index(:, :, 3) = base_index + SIZE; index_ref(:, :, 3) = base_index;
                    index(:, :, 4) = base_index + 2 * SIZE + 1; index_ref(:, :, 4) = base_index;
                    index(:, :, 5) = base_index - 4 * SIZE - 2; index_ref(:, :, 5) = index(:, :, 1);
                    index(:, 1, 5) = index(:, 1, 5) + 3 * SIZE + 4;
                    index(:, :, 6) = base_index - 3 * SIZE - 1; index_ref(:, :, 6) = index(:, :, 2);
                    index(:, 1, 6) = index(:, 1, 6) + SIZE + 2;
                    index(:, :, 7) = base_index - 2 * SIZE; index_ref(:, :, 7) = index(:, :, 2);
                    index(:, :, 8) = base_index - SIZE - 1; index_ref(:, :, 8) = index(:, :, 3);
                    index(:, :, 9) = base_index + SIZE + 1; index_ref(:, :, 9) = index(:, :, 2);
                    index(:, :, 10) = base_index + 2 * SIZE; index_ref(:, :, 10) = index(:, :, 3);
                    index(:, :, 11) = base_index + 3 * SIZE + 1; index_ref(:, :, 11) = index(:, :, 3);
                    index(:, 4, 11) = index(:, 4, 11) - SIZE - 2;
                    index(:, :, 12) = base_index + 4 * SIZE + 2; index_ref(:, :, 12) = index(:, :, 4);
                    index(:, 4, 12) = index(:, 4, 12) - 3 * SIZE - 4;
                    index(:, :, 13) = base_index - 5 * SIZE - 2; index_ref(:, :, 13) = index(:, :, 6);
                    index(:, 1, 13) = index(:, 1, 13) + 5 * SIZE + 4;
                    index(:, :, 14) = base_index - 4 * SIZE - 1; index_ref(:, :, 14) = index(:, :, 7);
                    index(:, 1, 14) = index(:, 1, 14) + 3 * SIZE + 2;
                    index(:, :, 15) = base_index - 3 * SIZE - 2; index_ref(:, :, 15) = index(:, :, 8);
                    index(:, 1, 15) = index(:, 1, 15) + SIZE + 4;
                    index(:, :, 16) = base_index - 1; index_ref(:, :, 16) = index(:, :, 10);
                    index(:, :, 17) = base_index + 1; index_ref(:, :, 17) = index(:, :, 7);
                    index(:, :, 18) = base_index + 3 * SIZE + 2; index_ref(:, :, 18) = index(:, :, 9);
                    index(:, 4, 18) = index(:, 4, 18) - SIZE - 4;
                    index(:, :, 19) = base_index + 4 * SIZE + 1; index_ref(:, :, 19) = index(:, :, 10);
                    index(:, 4, 19) = index(:, 4, 19) - 3 * SIZE - 2;
                    index(:, :, 20) = base_index + 5 * SIZE + 2; index_ref(:, :, 20) = index(:, :, 11);
                    index(:, 4, 20) = index(:, 4, 20) - 5 * SIZE - 4;
                    index(:, :, 21) = base_index - 6 * SIZE - 2; index_ref(:, :, 21) = index(:, :, 14);
                    index(:, 1, 21) = index(:, 1, 21) + 7 * SIZE + 4;
                    index(:, :, 22) = base_index - 2 * SIZE - 2; index_ref(:, :, 22) = index(:, :, 16);
                    index(:, :, 23) = base_index + 2 * SIZE + 2; index_ref(:, :, 23) = index(:, :, 17);
                    index(:, :, 24) = base_index + 6 * SIZE + 2; index_ref(:, :, 24) = index(:, :, 19);
                    index(:, 4, 24) = index(:, 4, 24) - 7 * SIZE - 4;
                case 3
                    index(:, :, 1) = base_index - SIZE - 1; index_ref(:, :, 1) = base_index;
                    index(:, :, 2) = base_index - SIZE; index_ref(:, :, 2) = base_index;
                    index(:, :, 3) = base_index + SIZE; index_ref(:, :, 3) = base_index;
                    index(:, :, 4) = base_index + SIZE + 1; index_ref(:, :, 4) = base_index;
                    index(:, :, 5) = base_index - 2 * SIZE - 2; index_ref(:, :, 5) = index(:, :, 1);
                    index(:, :, 6) = base_index - 2 * SIZE - 1; index_ref(:, :, 6) = index(:, :, 2);
                    index(:, :, 7) = base_index - 2 * SIZE; index_ref(:, :, 7) = index(:, :, 2);
                    index(:, :, 8) = base_index - 1; index_ref(:, :, 8) = index(:, :, 3);
                    index(:, :, 9) = base_index + 1; index_ref(:, :, 9) = index(:, :, 2);
                    index(:, :, 10) = base_index + 2 * SIZE; index_ref(:, :, 10) = index(:, :, 3);
                    index(:, :, 11) = base_index + 2 * SIZE + 1; index_ref(:, :, 11) = index(:, :, 3);
                    index(:, :, 12) = base_index + 2 * SIZE + 2; index_ref(:, :, 12) = index(:, :, 4);
                    index(:, :, 13) = base_index - 3 * SIZE - 2; index_ref(:, :, 13) = index(:, :, 6);
                    index(:, 1, 13) = index(:, 1, 13) + SIZE + 4;
                    index(:, :, 14) = base_index - 3 * SIZE - 1; index_ref(:, :, 14) = index(:, :, 7);
                    index(:, 1, 14) = index(:, 1, 14) + SIZE + 2;
                    index(:, :, 15) = base_index - SIZE - 2; index_ref(:, :, 15) = index(:, :, 8);
                    index(:, :, 16) = base_index - SIZE + 1; index_ref(:, :, 16) = index(:, :, 7);
                    index(:, :, 17) = base_index + SIZE - 1; index_ref(:, :, 17) = index(:, :, 10);
                    index(:, :, 18) = base_index + SIZE + 2; index_ref(:, :, 18) = index(:, :, 9);
                    index(:, :, 19) = base_index + 3 * SIZE + 1; index_ref(:, :, 19) = index(:, :, 10);
                    index(:, 4, 19) = index(:, 4, 19) - SIZE - 2;
                    index(:, :, 20) = base_index + 3 * SIZE + 2; index_ref(:, :, 20) = index(:, :, 11);
                    index(:, 4, 20) = index(:, 4, 20) - SIZE - 4;
                    index(:, :, 21) = base_index - 4 * SIZE - 2; index_ref(:, :, 21) = index(:, :, 14);
                    index(:, 1, 21) = index(:, 1, 21) + 3 * SIZE + 4;
                    index(:, :, 22) = base_index - 2; index_ref(:, :, 22) = index(:, :, 17);
                    index(:, :, 23) = base_index + 2; index_ref(:, :, 23) = index(:, :, 16);
                    index(:, :, 24) = base_index + 4 * SIZE + 2; index_ref(:, :, 24) = index(:, :, 19);
                    index(:, 4, 24) = index(:, 4, 24) - 3 * SIZE - 4;
                case 4
                    index(:, :, 1) = base_index - SIZE - 1; index_ref(:, :, 1) = base_index;
                    index(:, :, 2) = base_index - 1; index_ref(:, :, 2) = base_index;
                    index(:, :, 3) = base_index + 1; index_ref(:, :, 3) = base_index;
                    index(:, :, 4) = base_index + SIZE + 1; index_ref(:, :, 4) = base_index;
                    index(:, :, 5) = base_index - 2 * SIZE - 2; index_ref(:, :, 5) = index(:, :, 1);
                    index(:, :, 6) = base_index - SIZE - 2; index_ref(:, :, 6) = index(:, :, 2);
                    index(:, :, 7) = base_index - SIZE; index_ref(:, :, 7) = index(:, :, 3);
                    index(:, :, 8) = base_index - 2; index_ref(:, :, 8) = index(:, :, 2);
                    index(:, :, 9) = base_index + 2; index_ref(:, :, 9) = index(:, :, 3);
                    index(:, :, 10) = base_index + SIZE; index_ref(:, :, 10) = index(:, :, 2);
                    index(:, :, 11) = base_index + SIZE + 2; index_ref(:, :, 11) = index(:, :, 3);
                    index(:, :, 12) = base_index + 2 * SIZE + 2; index_ref(:, :, 12) = index(:, :, 4);
                    index(:, :, 13) = base_index - 2 * SIZE - 3; index_ref(:, :, 13) = index(:, :, 6);
                    index(1, :, 13) = index(1, :, 13) + 4 * SIZE + 1;
                    index(:, :, 14) = base_index - 2 * SIZE - 1; index_ref(:, :, 14) = index(:, :, 7);
                    index(:, :, 15) = base_index - SIZE - 3; index_ref(:, :, 15) = index(:, :, 8);
                    index(1, :, 15) = index(1, :, 15) + 2 * SIZE + 1;
                    index(:, :, 16) = base_index - SIZE + 1; index_ref(:, :, 16) = index(:, :, 9);
                    index(:, :, 17) = base_index + SIZE - 1; index_ref(:, :, 17) = index(:, :, 8);
                    index(:, :, 18) = base_index + SIZE + 3; index_ref(:, :, 18) = index(:, :, 9);
                    index(4, :, 18) = index(4, :, 18) - 2 * SIZE - 1;
                    index(:, :, 19) = base_index + 2 * SIZE + 1; index_ref(:, :, 19) = index(:, :, 10);
                    index(:, :, 20) = base_index + 2 * SIZE + 3; index_ref(:, :, 20) = index(:, :, 11);
                    index(4, :, 20) = index(4, :, 20) - 4 * SIZE - 1;
                    index(:, :, 21) = base_index - 2 * SIZE - 4; index_ref(:, :, 21) = index(:, :, 15);
                    index(1, :, 21) = index(1, :, 21) + 4 * SIZE + 3;
                    index(:, :, 22) = base_index - 2 * SIZE; index_ref(:, :, 22) = index(:, :, 16);
                    index(:, :, 23) = base_index + 2 * SIZE; index_ref(:, :, 23) = index(:, :, 17);
                    index(:, :, 24) = base_index + 2 * SIZE + 4; index_ref(:, :, 24) = index(:, :, 18);
                    index(4, :, 24) = index(4, :, 24) - 4 * SIZE - 3;
                case 5
                    index(:, :, 1) = base_index - SIZE - 2; index_ref(:, :, 1) = base_index;
                    index(:, :, 2) = base_index - 1; index_ref(:, :, 2) = base_index;
                    index(:, :, 3) = base_index + 1; index_ref(:, :, 3) = base_index;
                    index(:, :, 4) = base_index + SIZE + 2; index_ref(:, :, 4) = base_index;
                    index(:, :, 5) = base_index - 2 * SIZE - 4; index_ref(:, :, 5) = index(:, :, 1);
                    index(1, :, 5) = index(1, :, 5) + 4 * SIZE + 3;
                    index(:, :, 6) = base_index - SIZE - 3; index_ref(:, :, 6) = index(:, :, 2);
                    index(1, :, 6) = index(1, :, 6) + 2 * SIZE + 1;
                    index(:, :, 7) = base_index - SIZE - 1; index_ref(:, :, 7) = index(:, :, 3);
                    index(:, :, 8) = base_index - 2; index_ref(:, :, 8) = index(:, :, 2);
                    index(:, :, 9) = base_index + 2; index_ref(:, :, 9) = index(:, :, 3);
                    index(:, :, 10) = base_index + SIZE + 1; index_ref(:, :, 10) = index(:, :, 2);
                    index(:, :, 11) = base_index + SIZE + 3; index_ref(:, :, 11) = index(:, :, 3);
                    index(4, :, 11) = index(4, :, 11) - 2 * SIZE - 1;
                    index(:, :, 12) = base_index + 2 * SIZE + 4; index_ref(:, :, 12) = index(:, :, 4);
                    index(4, :, 12) = index(4, :, 12) - 4 * SIZE - 3;
                    index(:, :, 13) = base_index - 2 * SIZE - 5; index_ref(:, :, 13) = index(:, :, 6);
                    index(1, :, 13) = index(1, :, 13) + 4 * SIZE + 5;
                    index(:, :, 14) = base_index - 2 * SIZE - 3; index_ref(:, :, 14) = index(:, :, 7);
                    index(1, :, 14) = index(1, :, 14) + 4 * SIZE + 1;
                    index(:, :, 15) = base_index - SIZE - 4; index_ref(:, :, 15) = index(:, :, 8);
                    index(1, :, 15) = index(1, :, 15) + 2 * SIZE + 3;
                    index(:, :, 16) = base_index - SIZE; index_ref(:, :, 16) = index(:, :, 9);
                    index(:, :, 17) = base_index + SIZE; index_ref(:, :, 17) = index(:, :, 8);
                    index(:, :, 18) = base_index + SIZE + 4; index_ref(:, :, 18) = index(:, :, 9);
                    index(4, :, 18) = index(4, :, 18) - 2 * SIZE - 3;
                    index(:, :, 19) = base_index + 2 * SIZE + 3; index_ref(:, :, 19) = index(:, :, 10);
                    index(4, :, 19) = index(4, :, 19) - 4 * SIZE - 1;
                    index(:, :, 20) = base_index + 2 * SIZE + 5; index_ref(:, :, 20) = index(:, :, 11);
                    index(4, :, 20) = index(4, :, 20) - 4 * SIZE - 5;
                    index(:, :, 21) = base_index - 2 * SIZE - 6; index_ref(:, :, 21) = index(:, :, 15);
                    index(1, :, 21) = index(1, :, 21) + 4 * SIZE + 7;
                    index(:, :, 22) = base_index - 2 * SIZE - 2; index_ref(:, :, 22) = index(:, :, 16);
                    index(:, :, 23) = base_index + 2 * SIZE + 2; index_ref(:, :, 23) = index(:, :, 17);
                    index(:, :, 24) = base_index + 2 * SIZE + 6; index_ref(:, :, 24) = index(:, :, 18);
                    index(4, :, 24) = index(4, :, 24) - 4 * SIZE - 7;
                case 6
                    index(:, :, 1) = base_index - SIZE; index_ref(:, :, 1) = base_index;
                    index(:, :, 2) = base_index - 1; index_ref(:, :, 2) = base_index;
                    index(:, :, 3) = base_index + 1; index_ref(:, :, 3) = base_index;
                    index(:, :, 4) = base_index + SIZE; index_ref(:, :, 4) = base_index;
                    index(:, :, 5) = base_index - 2 * SIZE; index_ref(:, :, 5) = index(:, :, 1);
                    index(:, :, 6) = base_index - SIZE - 1; index_ref(:, :, 6) = index(:, :, 1);
                    index(:, :, 7) = base_index - SIZE + 1; index_ref(:, :, 7) = index(:, :, 1);
                    index(:, :, 8) = base_index - 2; index_ref(:, :, 8) = index(:, :, 2);
                    index(:, :, 9) = base_index + 2; index_ref(:, :, 9) = index(:, :, 3);
                    index(:, :, 10) = base_index + SIZE - 1; index_ref(:, :, 10) = index(:, :, 4);
                    index(:, :, 11) = base_index + SIZE + 1; index_ref(:, :, 11) = index(:, :, 4);
                    index(:, :, 12) = base_index + 2 * SIZE; index_ref(:, :, 12) = index(:, :, 4);
                    index(:, :, 13) = base_index - 2 * SIZE - 1; index_ref(:, :, 13) = index(:, :, 5);
                    index(:, :, 14) = base_index - 2 * SIZE + 1; index_ref(:, :, 14) = index(:, :, 5);
                    index(:, :, 15) = base_index - SIZE - 2; index_ref(:, :, 15) = index(:, :, 6);
                    index(:, :, 16) = base_index - SIZE + 2; index_ref(:, :, 16) = index(:, :, 7);
                    index(:, :, 17) = base_index + SIZE - 2; index_ref(:, :, 17) = index(:, :, 10);
                    index(:, :, 18) = base_index + SIZE + 2; index_ref(:, :, 18) = index(:, :, 11);
                    index(:, :, 19) = base_index + 2 * SIZE - 1; index_ref(:, :, 19) = index(:, :, 12);
                    index(:, :, 20) = base_index + 2 * SIZE + 1; index_ref(:, :, 20) = index(:, :, 12);
                    index(:, :, 21) = base_index - 2 * SIZE - 2; index_ref(:, :, 21) = index(:, :, 13);
                    index(:, :, 22) = base_index - 2 * SIZE + 2; index_ref(:, :, 22) = index(:, :, 14);
                    index(:, :, 23) = base_index + 2 * SIZE - 2; index_ref(:, :, 23) = index(:, :, 19);
                    index(:, :, 24) = base_index + 2 * SIZE + 2; index_ref(:, :, 24) = index(:, :, 20);
                case 7
                    index(:, :, 1) = base_index - SIZE + 2; index_ref(:, :, 1) = base_index;
                    index(:, :, 2) = base_index - 1; index_ref(:, :, 2) = base_index;
                    index(:, :, 3) = base_index + 1; index_ref(:, :, 3) = base_index;
                    index(:, :, 4) = base_index + SIZE - 2; index_ref(:, :, 4) = base_index;
                    index(:, :, 5) = base_index - 2 * SIZE + 4; index_ref(:, :, 5) = index(:, :, 1);
                    index(4, :, 5) = index(4, :, 5) + 4 * SIZE - 3;
                    index(:, :, 6) = base_index - SIZE + 1; index_ref(:, :, 6) = index(:, :, 2);
                    index(:, :, 7) = base_index - SIZE + 3; index_ref(:, :, 7) = index(:, :, 3);
                    index(4, :, 7) = index(4, :, 7) + 2 * SIZE - 1;
                    index(:, :, 8) = base_index - 2; index_ref(:, :, 8) = index(:, :, 2);
                    index(:, :, 9) = base_index + 2; index_ref(:, :, 9) = index(:, :, 3);
                    index(:, :, 10) = base_index + SIZE - 3; index_ref(:, :, 10) = index(:, :, 2);
                    index(1, :, 10) = index(1, :, 10) - 2 * SIZE + 1;
                    index(:, :, 11) = base_index + SIZE - 1; index_ref(:, :, 11) = index(:, :, 3);
                    index(:, :, 12) = base_index + 2 * SIZE - 4; index_ref(:, :, 12) = index(:, :, 4);
                    index(1, :, 12) = index(1, :, 12) - 4 * SIZE + 3;
                    index(:, :, 13) = base_index - 2 * SIZE + 3; index_ref(:, :, 13) = index(:, :, 6);
                    index(4, :, 13) = index(4, :, 13) + 4 * SIZE - 1;
                    index(:, :, 14) = base_index - 2 * SIZE + 5; index_ref(:, :, 14) = index(:, :, 7);
                    index(4, :, 14) = index(4, :, 14) + 4 * SIZE - 5;
                    index(:, :, 15) = base_index - SIZE; index_ref(:, :, 15) = index(:, :, 8);
                    index(:, :, 16) = base_index - SIZE + 4; index_ref(:, :, 16) = index(:, :, 9);
                    index(4, :, 16) = index(4, :, 16) + 2 * SIZE - 3;
                    index(:, :, 17) = base_index + SIZE - 4; index_ref(:, :, 17) = index(:, :, 8);
                    index(1, :, 17) = index(1, :, 17) - 2 * SIZE + 3;
                    index(:, :, 18) = base_index + SIZE; index_ref(:, :, 18) = index(:, :, 9);
                    index(:, :, 19) = base_index + 2 * SIZE - 5; index_ref(:, :, 19) = index(:, :, 10);
                    index(1, :, 19) = index(1, :, 19) - 4 * SIZE + 5;
                    index(:, :, 20) = base_index + 2 * SIZE - 3; index_ref(:, :, 20) = index(:, :, 11);
                    index(1, :, 20) = index(1, :, 20) - 4 * SIZE + 1;
                    index(:, :, 21) = base_index - 2 * SIZE + 2; index_ref(:, :, 21) = index(:, :, 15);
                    index(:, :, 22) = base_index - 2 * SIZE + 6; index_ref(:, :, 22) = index(:, :, 16);
                    index(4, :, 22) = index(4, :, 22) + 4 * SIZE - 7;
                    index(:, :, 23) = base_index + 2 * SIZE - 6; index_ref(:, :, 23) = index(:, :, 17);
                    index(1, :, 23) = index(1, :, 23) - 4 * SIZE + 7;
                    index(:, :, 24) = base_index + 2 * SIZE - 2; index_ref(:, :, 24) = index(:, :, 18);
                case 8
                    index(:, :, 1) = base_index - SIZE; index_ref(:, :, 1) = base_index;
                    index(:, :, 2) = base_index - SIZE + 1; index_ref(:, :, 2) = base_index;
                    index(:, :, 3) = base_index + SIZE - 1; index_ref(:, :, 3) = base_index;
                    index(:, :, 4) = base_index + SIZE; index_ref(:, :, 4) = base_index;
                    index(:, :, 5) = base_index - 2 * SIZE; index_ref(:, :, 5) = index(:, :, 1);
                    index(:, :, 6) = base_index - 2 * SIZE + 1; index_ref(:, :, 6) = index(:, :, 1);
                    index(:, :, 7) = base_index - 2 * SIZE + 2; index_ref(:, :, 7) = index(:, :, 2);
                    index(:, :, 8) = base_index - 1; index_ref(:, :, 8) = index(:, :, 1);
                    index(:, :, 9) = base_index + 1; index_ref(:, :, 9) = index(:, :, 4);
                    index(:, :, 10) = base_index + 2 * SIZE - 2; index_ref(:, :, 10) = index(:, :, 3);
                    index(:, :, 11) = base_index + 2 * SIZE - 1; index_ref(:, :, 11) = index(:, :, 4);
                    index(:, :, 12) = base_index + 2 * SIZE; index_ref(:, :, 12) = index(:, :, 4);
                    index(:, :, 13) = base_index - 3 * SIZE + 1; index_ref(:, :, 13) = index(:, :, 5);
                    index(:, 1, 13) = index(:, 1, 13) + SIZE - 2;
                    index(:, :, 14) = base_index - 3 * SIZE + 2; index_ref(:, :, 14) = index(:, :, 6);
                    index(:, 1, 14) = index(:, 1, 14) + SIZE - 4;
                    index(:, :, 15) = base_index - SIZE - 1; index_ref(:, :, 15) = index(:, :, 5);
                    index(:, :, 16) = base_index - SIZE + 2; index_ref(:, :, 16) = index(:, :, 9);
                    index(:, :, 17) = base_index + SIZE - 2; index_ref(:, :, 17) = index(:, :, 8);
                    index(:, :, 18) = base_index + SIZE + 1; index_ref(:, :, 18) = index(:, :, 12);
                    index(:, :, 19) = base_index + 3 * SIZE - 2; index_ref(:, :, 19) = index(:, :, 11);
                    index(:, 4, 19) = index(:, 4, 19) - SIZE + 4;
                    index(:, :, 20) = base_index + 3 * SIZE - 1; index_ref(:, :, 20) = index(:, :, 12);
                    index(:, 4, 20) = index(:, 4, 20) - SIZE + 2;
                    index(:, :, 21) = base_index - 4 * SIZE + 2; index_ref(:, :, 21) = index(:, :, 13);
                    index(:, 1, 21) = index(:, 1, 21) + 3 * SIZE - 4;
                    index(:, :, 22) = base_index - 2; index_ref(:, :, 22) = index(:, :, 15);
                    index(:, :, 23) = base_index + 2; index_ref(:, :, 23) = index(:, :, 18);
                    index(:, :, 24) = base_index + 4 * SIZE - 2; index_ref(:, :, 24) = index(:, :, 20);
                    index(:, 4, 24) = index(:, 4, 24) - 3 * SIZE + 4;
                case 9
                    index(:, :, 1) = base_index - SIZE + 1; index_ref(:, :, 1) = base_index;
                    index(:, :, 2) = base_index - 1; index_ref(:, :, 2) = base_index;
                    index(:, :, 3) = base_index + 1; index_ref(:, :, 3) = base_index;
                    index(:, :, 4) = base_index + SIZE - 1; index_ref(:, :, 4) = base_index;
                    index(:, :, 5) = base_index - 2 * SIZE + 2; index_ref(:, :, 5) = index(:, :, 1);
                    index(:, :, 6) = base_index - SIZE; index_ref(:, :, 6) = index(:, :, 2);
                    index(:, :, 7) = base_index - SIZE + 2; index_ref(:, :, 7) = index(:, :, 3);
                    index(:, :, 8) = base_index - 2; index_ref(:, :, 8) = index(:, :, 2);
                    index(:, :, 9) = base_index + 2; index_ref(:, :, 9) = index(:, :, 3);
                    index(:, :, 10) = base_index + SIZE - 2; index_ref(:, :, 10) = index(:, :, 2);
                    index(:, :, 11) = base_index + SIZE; index_ref(:, :, 11) = index(:, :, 3);
                    index(:, :, 12) = base_index + 2 * SIZE - 2; index_ref(:, :, 12) = index(:, :, 4);
                    index(:, :, 13) = base_index - 2 * SIZE + 1; index_ref(:, :, 13) = index(:, :, 6);
                    index(:, :, 14) = base_index - 2 * SIZE + 3; index_ref(:, :, 14) = index(:, :, 7);
                    index(4, :, 14) = index(4, :, 14) + 4 * SIZE - 1;
                    index(:, :, 15) = base_index - SIZE - 1; index_ref(:, :, 15) = index(:, :, 8);
                    index(:, :, 16) = base_index - SIZE + 3; index_ref(:, :, 16) = index(:, :, 9);
                    index(4, :, 16) = index(4, :, 16) + 2 * SIZE - 1;
                    index(:, :, 17) = base_index + SIZE - 3; index_ref(:, :, 17) = index(:, :, 8);
                    index(1, :, 17) = index(1, :, 17) - 2 * SIZE + 1;
                    index(:, :, 18) = base_index + SIZE + 1; index_ref(:, :, 18) = index(:, :, 9);
                    index(:, :, 19) = base_index + 2 * SIZE - 3; index_ref(:, :, 19) = index(:, :, 10);
                    index(1, :, 19) = index(1, :, 19) - 4 * SIZE + 1;
                    index(:, :, 20) = base_index + 2 * SIZE - 1; index_ref(:, :, 20) = index(:, :, 11);
                    index(:, :, 21) = base_index - 2 * SIZE; index_ref(:, :, 21) = index(:, :, 15);
                    index(:, :, 22) = base_index - 2 * SIZE + 4; index_ref(:, :, 22) = index(:, :, 16);
                    index(4, :, 22) = index(4, :, 22) + 4 * SIZE - 3;
                    index(:, :, 23) = base_index + 2 * SIZE - 4; index_ref(:, :, 23) = index(:, :, 17);
                    index(1, :, 23) = index(1, :, 23) - 4 * SIZE + 3;
                    index(:, :, 24) = base_index + 2 * SIZE; index_ref(:, :, 24) = index(:, :, 18);
                case 10
                    index(:, :, 1) = base_index - 2 * SIZE + 1; index_ref(:, :, 1) = base_index;
                    index(:, :, 2) = base_index - SIZE; index_ref(:, :, 2) = base_index;
                    index(:, :, 3) = base_index + SIZE; index_ref(:, :, 3) = base_index;
                    index(:, :, 4) = base_index + 2 * SIZE - 1; index_ref(:, :, 4) = base_index;
                    index(:, :, 5) = base_index - 4 * SIZE + 2; index_ref(:, :, 5) = index(:, :, 1);
                    index(:, 1, 5) = index(:, 1, 5) + 3 * SIZE - 4;
                    index(:, :, 6) = base_index - 3 * SIZE + 1; index_ref(:, :, 6) = index(:, :, 2);
                    index(:, 1, 6) = index(:, 1, 6) + SIZE - 2;
                    index(:, :, 7) = base_index - 2 * SIZE; index_ref(:, :, 7) = index(:, :, 2);
                    index(:, :, 8) = base_index - SIZE + 1; index_ref(:, :, 8) = index(:, :, 3);
                    index(:, :, 9) = base_index + SIZE - 1; index_ref(:, :, 9) = index(:, :, 2);
                    index(:, :, 10) = base_index + 2 * SIZE; index_ref(:, :, 10) = index(:, :, 3);
                    index(:, :, 11) = base_index + 3 * SIZE - 1; index_ref(:, :, 11) = index(:, :, 3);
                    index(:, 4, 11) = index(:, 4, 11) - SIZE + 2;
                    index(:, :, 12) = base_index + 4 * SIZE - 2; index_ref(:, :, 12) = index(:, :, 4);
                    index(:, 4, 12) = index(:, 4, 12) - 3 * SIZE + 4;
                    index(:, :, 13) = base_index - 5 * SIZE + 2; index_ref(:, :, 13) = index(:, :, 6);
                    index(:, 1, 13) = index(:, 1, 13) + 5 * SIZE - 4;
                    index(:, :, 14) = base_index - 4 * SIZE + 1; index_ref(:, :, 14) = index(:, :, 7);
                    index(:, 1, 14) = index(:, 1, 14) + 3 * SIZE - 2;
                    index(:, :, 15) = base_index - 3 * SIZE + 2; index_ref(:, :, 15) = index(:, :, 8);
                    index(:, 1, 15) = index(:, 1, 15) + SIZE - 4;
                    index(:, :, 16) = base_index - 1; index_ref(:, :, 16) = index(:, :, 7);
                    index(:, :, 17) = base_index + 1; index_ref(:, :, 17) = index(:, :, 10);
                    index(:, :, 18) = base_index + 3 * SIZE - 2; index_ref(:, :, 18) = index(:, :, 9);
                    index(:, 4, 18) = index(:, 4, 18) - SIZE + 4;
                    index(:, :, 19) = base_index + 4 * SIZE - 1; index_ref(:, :, 19) = index(:, :, 10);
                    index(:, 4, 19) = index(:, 4, 19) - 3 * SIZE + 2;
                    index(:, :, 20) = base_index + 5 * SIZE - 2; index_ref(:, :, 20) = index(:, :, 11);
                    index(:, 4, 20) = index(:, 4, 20) - 5 * SIZE + 4;
                    index(:, :, 21) = base_index - 6 * SIZE + 2; index_ref(:, :, 21) = index(:, :, 14);
                    index(:, 1, 21) = index(:, 1, 21) + 7 * SIZE - 4;
                    index(:, :, 22) = base_index - 2 * SIZE + 2; index_ref(:, :, 22) = index(:, :, 17);
                    index(:, :, 23) = base_index + 2 * SIZE - 2; index_ref(:, :, 23) = index(:, :, 16);
                    index(:, :, 24) = base_index + 6 * SIZE - 2; index_ref(:, :, 24) = index(:, :, 19);
                    index(:, 4, 24) = index(:, 4, 24) - 7 * SIZE + 4;
            end
        case 10
            base_index = [[23:5:30]', 50 + [23:5:30]'];
            index = zeros(2, 2, 24);
            index_ref = index;
            b4_enc_fixval = zeros(2, 2, 24);
            switch mode
                case 1
                    index(:, :, 1) = base_index - SIZE; index_ref(:, :, 1) = base_index;
                    index(:, :, 2) = base_index - 1; index_ref(:, :, 2) = base_index;
                    index(:, :, 3) = base_index + 1; index_ref(:, :, 3) = base_index;
                    index(:, :, 4) = base_index + SIZE; index_ref(:, :, 4) = base_index;
                    index(:, :, 5) = base_index - 2 * SIZE; index_ref(:, :, 5) = index(:, :, 1);
                    index(:, :, 6) = base_index - SIZE - 1; index_ref(:, :, 6) = index(:, :, 2);
                    index(:, :, 7) = base_index - SIZE + 1; index_ref(:, :, 7) = index(:, :, 3);
                    index(:, :, 8) = base_index - 2; index_ref(:, :, 8) = index(:, :, 2);
                    index(:, :, 9) = base_index + 2; index_ref(:, :, 9) = index(:, :, 3);
                    index(:, :, 10) = base_index + SIZE - 1; index_ref(:, :, 10) = index(:, :, 2);
                    index(:, :, 11) = base_index + SIZE + 1; index_ref(:, :, 11) = index(:, :, 3);
                    index(:, :, 12) = base_index + 2 * SIZE; index_ref(:, :, 12) = index(:, :, 4);
                    index(:, :, 13) = base_index - 2 * SIZE - 1; index_ref(:, :, 13) = index(:, :, 6);
                    index(:, :, 14) = base_index - 2 * SIZE + 1; index_ref(:, :, 14) = index(:, :, 7);
                    index(:, :, 15) = base_index - SIZE - 2; index_ref(:, :, 15) = index(:, :, 8);
                    index(:, :, 16) = base_index - SIZE + 2; index_ref(:, :, 16) = index(:, :, 9);
                    index(:, :, 17) = base_index + SIZE - 2; index_ref(:, :, 17) = index(:, :, 8);
                    index(:, :, 18) = base_index + SIZE + 2; index_ref(:, :, 18) = index(:, :, 9);
                    index(:, :, 19) = base_index + 2 * SIZE - 1; index_ref(:, :, 19) = index(:, :, 10);
                    index(:, :, 20) = base_index + 2 * SIZE + 1; index_ref(:, :, 20) = index(:, :, 11);
                    index(:, :, 21) = base_index - 2 * SIZE - 2; index_ref(:, :, 21) = index(:, :, 15);
                    index(:, :, 22) = base_index - 2 * SIZE + 2; index_ref(:, :, 22) = index(:, :, 16);
                    index(:, :, 23) = base_index + 2 * SIZE - 2; index_ref(:, :, 23) = index(:, :, 17);
                    index(:, :, 24) = base_index + 2 * SIZE + 2; index_ref(:, :, 24) = index(:, :, 18);
                case 2
                    index(:, :, 1) = base_index - 2 * SIZE - 1; index_ref(:, :, 1) = base_index;
                    index(:, :, 2) = base_index - SIZE; index_ref(:, :, 2) = base_index;
                    index(:, :, 3) = base_index + SIZE; index_ref(:, :, 3) = base_index;
                    index(:, :, 4) = base_index + 2 * SIZE + 1; index_ref(:, :, 4) = base_index;
                    index(:, :, 5) = base_index - 4 * SIZE - 2; index_ref(:, :, 5) = index(:, :, 1);
                    index(:, 1, 5) = index(:, 1, 5) + 3 * SIZE + 4;
                    index(:, :, 6) = base_index - 3 * SIZE - 1; index_ref(:, :, 6) = index(:, :, 2);
                    index(:, 1, 6) = index(:, 1, 6) + SIZE + 2;
                    index(:, :, 7) = base_index - 2 * SIZE; index_ref(:, :, 7) = index(:, :, 2);
                    index(:, :, 8) = base_index - SIZE - 1; index_ref(:, :, 8) = index(:, :, 3);
                    index(:, :, 9) = base_index + SIZE + 1; index_ref(:, :, 9) = index(:, :, 2);
                    index(:, :, 10) = base_index + 2 * SIZE; index_ref(:, :, 10) = index(:, :, 3);
                    index(:, :, 11) = base_index + 3 * SIZE + 1; index_ref(:, :, 11) = index(:, :, 3);
                    index(:, 2, 11) = index(:, 2, 11) - SIZE - 2;
                    index(:, :, 12) = base_index + 4 * SIZE + 2; index_ref(:, :, 12) = index(:, :, 4);
                    index(:, 2, 12) = index(:, 2, 12) - 3 * SIZE - 4;
                    index(:, :, 13) = base_index - 5 * SIZE - 2; index_ref(:, :, 13) = index(:, :, 6);
                    index(:, 1, 13) = index(:, 1, 13) + 5 * SIZE + 4;
                    index(:, :, 14) = base_index - 4 * SIZE - 1; index_ref(:, :, 14) = index(:, :, 7);
                    index(:, 1, 14) = index(:, 1, 14) + 3 * SIZE + 2;
                    index(:, :, 15) = base_index - 3 * SIZE - 2; index_ref(:, :, 15) = index(:, :, 8);
                    index(:, 1, 15) = index(:, 1, 15) + SIZE + 4;
                    index(:, :, 16) = base_index - 1; index_ref(:, :, 16) = index(:, :, 10);
                    index(:, :, 17) = base_index + 1; index_ref(:, :, 17) = index(:, :, 7);
                    index(:, :, 18) = base_index + 3 * SIZE + 2; index_ref(:, :, 18) = index(:, :, 9);
                    index(:, 2, 18) = index(:, 2, 18) - SIZE - 4;
                    index(:, :, 19) = base_index + 4 * SIZE + 1; index_ref(:, :, 19) = index(:, :, 10);
                    index(:, 2, 19) = index(:, 2, 19) - 3 * SIZE - 2;
                    index(:, :, 20) = base_index + 5 * SIZE + 2; index_ref(:, :, 20) = index(:, :, 11);
                    index(:, 2, 20) = index(:, 2, 20) - 5 * SIZE - 4;
                    index(:, :, 21) = base_index - 6 * SIZE - 2; index_ref(:, :, 21) = index(:, :, 14);
                    index(:, 1, 21) = index(:, 1, 21) + 7 * SIZE + 4;
                    index(:, :, 22) = base_index - 2 * SIZE - 2; index_ref(:, :, 22) = index(:, :, 16);
                    index(:, :, 23) = base_index + 2 * SIZE + 2; index_ref(:, :, 23) = index(:, :, 17);
                    index(:, :, 24) = base_index + 6 * SIZE + 2; index_ref(:, :, 24) = index(:, :, 19);
                    index(:, 2, 24) = index(:, 2, 24) - 7 * SIZE - 4;
                case 3
                    index(:, :, 1) = base_index - SIZE - 1; index_ref(:, :, 1) = base_index;
                    index(:, :, 2) = base_index - SIZE; index_ref(:, :, 2) = base_index;
                    index(:, :, 3) = base_index + SIZE; index_ref(:, :, 3) = base_index;
                    index(:, :, 4) = base_index + SIZE + 1; index_ref(:, :, 4) = base_index;
                    index(:, :, 5) = base_index - 2 * SIZE - 2; index_ref(:, :, 5) = index(:, :, 1);
                    index(:, :, 6) = base_index - 2 * SIZE - 1; index_ref(:, :, 6) = index(:, :, 2);
                    index(:, :, 7) = base_index - 2 * SIZE; index_ref(:, :, 7) = index(:, :, 2);
                    index(:, :, 8) = base_index - 1; index_ref(:, :, 8) = index(:, :, 3);
                    index(:, :, 9) = base_index + 1; index_ref(:, :, 9) = index(:, :, 2);
                    index(:, :, 10) = base_index + 2 * SIZE; index_ref(:, :, 10) = index(:, :, 3);
                    index(:, :, 11) = base_index + 2 * SIZE + 1; index_ref(:, :, 11) = index(:, :, 3);
                    index(:, :, 12) = base_index + 2 * SIZE + 2; index_ref(:, :, 12) = index(:, :, 4);
                    index(:, :, 13) = base_index - 3 * SIZE - 2; index_ref(:, :, 13) = index(:, :, 6);
                    index(:, 1, 13) = index(:, 1, 13) + SIZE + 4;
                    index(:, :, 14) = base_index - 3 * SIZE - 1; index_ref(:, :, 14) = index(:, :, 7);
                    index(:, 1, 14) = index(:, 1, 14) + SIZE + 2;
                    index(:, :, 15) = base_index - SIZE - 2; index_ref(:, :, 15) = index(:, :, 8);
                    index(:, :, 16) = base_index - SIZE + 1; index_ref(:, :, 16) = index(:, :, 7);
                    index(:, :, 17) = base_index + SIZE - 1; index_ref(:, :, 17) = index(:, :, 10);
                    index(:, :, 18) = base_index + SIZE + 2; index_ref(:, :, 18) = index(:, :, 9);
                    index(:, :, 19) = base_index + 3 * SIZE + 1; index_ref(:, :, 19) = index(:, :, 10);
                    index(:, 2, 19) = index(:, 2, 19) - SIZE - 2;
                    index(:, :, 20) = base_index + 3 * SIZE + 2; index_ref(:, :, 20) = index(:, :, 11);
                    index(:, 2, 20) = index(:, 2, 20) - SIZE - 4;
                    index(:, :, 21) = base_index - 4 * SIZE - 2; index_ref(:, :, 21) = index(:, :, 14);
                    index(:, 1, 21) = index(:, 1, 21) + 3 * SIZE + 4;
                    index(:, :, 22) = base_index - 2; index_ref(:, :, 22) = index(:, :, 17);
                    index(:, :, 23) = base_index + 2; index_ref(:, :, 23) = index(:, :, 16);
                    index(:, :, 24) = base_index + 4 * SIZE + 2; index_ref(:, :, 24) = index(:, :, 19);
                    index(:, 2, 24) = index(:, 2, 24) - 3 * SIZE - 4;
                case 4
                    index(:, :, 1) = base_index - SIZE - 1; index_ref(:, :, 1) = base_index;
                    index(:, :, 2) = base_index - 1; index_ref(:, :, 2) = base_index;
                    index(:, :, 3) = base_index + 1; index_ref(:, :, 3) = base_index;
                    index(:, :, 4) = base_index + SIZE + 1; index_ref(:, :, 4) = base_index;
                    index(:, :, 5) = base_index - 2 * SIZE - 2; index_ref(:, :, 5) = index(:, :, 1);
                    index(:, :, 6) = base_index - SIZE - 2; index_ref(:, :, 6) = index(:, :, 2);
                    index(:, :, 7) = base_index - SIZE; index_ref(:, :, 7) = index(:, :, 3);
                    index(:, :, 8) = base_index - 2; index_ref(:, :, 8) = index(:, :, 2);
                    index(:, :, 9) = base_index + 2; index_ref(:, :, 9) = index(:, :, 3);
                    index(:, :, 10) = base_index + SIZE; index_ref(:, :, 10) = index(:, :, 2);
                    index(:, :, 11) = base_index + SIZE + 2; index_ref(:, :, 11) = index(:, :, 3);
                    index(:, :, 12) = base_index + 2 * SIZE + 2; index_ref(:, :, 12) = index(:, :, 4);
                    index(:, :, 13) = base_index - 2 * SIZE - 3; index_ref(:, :, 13) = index(:, :, 6);
                    index(1, :, 13) = index(1, :, 13) + 4 * SIZE + 1;
                    index(:, :, 14) = base_index - 2 * SIZE - 1; index_ref(:, :, 14) = index(:, :, 7);
                    index(:, :, 15) = base_index - SIZE - 3; index_ref(:, :, 15) = index(:, :, 8);
                    index(1, :, 15) = index(1, :, 15) + 2 * SIZE + 1;
                    index(:, :, 16) = base_index - SIZE + 1; index_ref(:, :, 16) = index(:, :, 9);
                    index(:, :, 17) = base_index + SIZE - 1; index_ref(:, :, 17) = index(:, :, 8);
                    index(:, :, 18) = base_index + SIZE + 3; index_ref(:, :, 18) = index(:, :, 9);
                    index(2, :, 18) = index(2, :, 18) - 2 * SIZE - 1;
                    index(:, :, 19) = base_index + 2 * SIZE + 1; index_ref(:, :, 19) = index(:, :, 10);
                    index(:, :, 20) = base_index + 2 * SIZE + 3; index_ref(:, :, 20) = index(:, :, 11);
                    index(2, :, 20) = index(2, :, 20) - 4 * SIZE - 1;
                    index(:, :, 21) = base_index - 2 * SIZE - 4; index_ref(:, :, 21) = index(:, :, 15);
                    index(1, :, 21) = index(1, :, 21) + 4 * SIZE + 3;
                    index(:, :, 22) = base_index - 2 * SIZE; index_ref(:, :, 22) = index(:, :, 16);
                    index(:, :, 23) = base_index + 2 * SIZE; index_ref(:, :, 23) = index(:, :, 17);
                    index(:, :, 24) = base_index + 2 * SIZE + 4; index_ref(:, :, 24) = index(:, :, 18);
                    index(2, :, 24) = index(2, :, 24) - 4 * SIZE - 3;
                case 5
                    index(:, :, 1) = base_index - SIZE - 2; index_ref(:, :, 1) = base_index;
                    index(:, :, 2) = base_index - 1; index_ref(:, :, 2) = base_index;
                    index(:, :, 3) = base_index + 1; index_ref(:, :, 3) = base_index;
                    index(:, :, 4) = base_index + SIZE + 2; index_ref(:, :, 4) = base_index;
                    index(:, :, 5) = base_index - 2 * SIZE - 4; index_ref(:, :, 5) = index(:, :, 1);
                    index(1, :, 5) = index(1, :, 5) + 4 * SIZE + 3;
                    index(:, :, 6) = base_index - SIZE - 3; index_ref(:, :, 6) = index(:, :, 2);
                    index(1, :, 6) = index(1, :, 6) + 2 * SIZE + 1;
                    index(:, :, 7) = base_index - SIZE - 1; index_ref(:, :, 7) = index(:, :, 3);
                    index(:, :, 8) = base_index - 2; index_ref(:, :, 8) = index(:, :, 2);
                    index(:, :, 9) = base_index + 2; index_ref(:, :, 9) = index(:, :, 3);
                    index(:, :, 10) = base_index + SIZE + 1; index_ref(:, :, 10) = index(:, :, 2);
                    index(:, :, 11) = base_index + SIZE + 3; index_ref(:, :, 11) = index(:, :, 3);
                    index(2, :, 11) = index(2, :, 11) - 2 * SIZE - 1;
                    index(:, :, 12) = base_index + 2 * SIZE + 4; index_ref(:, :, 12) = index(:, :, 4);
                    index(2, :, 12) = index(2, :, 12) - 4 * SIZE - 3;
                    index(:, :, 13) = base_index - 2 * SIZE - 5; index_ref(:, :, 13) = index(:, :, 6);
                    index(1, :, 13) = index(1, :, 13) + 4 * SIZE + 5;
                    index(:, :, 14) = base_index - 2 * SIZE - 3; index_ref(:, :, 14) = index(:, :, 7);
                    index(1, :, 14) = index(1, :, 14) + 4 * SIZE + 1;
                    index(:, :, 15) = base_index - SIZE - 4; index_ref(:, :, 15) = index(:, :, 8);
                    index(1, :, 15) = index(1, :, 15) + 2 * SIZE + 3;
                    index(:, :, 16) = base_index - SIZE; index_ref(:, :, 16) = index(:, :, 9);
                    index(:, :, 17) = base_index + SIZE; index_ref(:, :, 17) = index(:, :, 8);
                    index(:, :, 18) = base_index + SIZE + 4; index_ref(:, :, 18) = index(:, :, 9);
                    index(2, :, 18) = index(2, :, 18) - 2 * SIZE - 3;
                    index(:, :, 19) = base_index + 2 * SIZE + 3; index_ref(:, :, 19) = index(:, :, 10);
                    index(2, :, 19) = index(2, :, 19) - 4 * SIZE - 1;
                    index(:, :, 20) = base_index + 2 * SIZE + 5; index_ref(:, :, 20) = index(:, :, 11);
                    index(2, :, 20) = index(2, :, 20) - 4 * SIZE - 5;
                    index(:, :, 21) = base_index - 2 * SIZE - 6; index_ref(:, :, 21) = index(:, :, 15);
                    index(1, :, 21) = index(1, :, 21) + 4 * SIZE + 7;
                    index(:, :, 22) = base_index - 2 * SIZE - 2; index_ref(:, :, 22) = index(:, :, 16);
                    index(:, :, 23) = base_index + 2 * SIZE + 2; index_ref(:, :, 23) = index(:, :, 17);
                    index(:, :, 24) = base_index + 2 * SIZE + 6; index_ref(:, :, 24) = index(:, :, 18);
                    index(2, :, 24) = index(2, :, 24) - 4 * SIZE - 7;
                case 6
                    index(:, :, 1) = base_index - SIZE; index_ref(:, :, 1) = base_index;
                    index(:, :, 2) = base_index - 1; index_ref(:, :, 2) = base_index;
                    index(:, :, 3) = base_index + 1; index_ref(:, :, 3) = base_index;
                    index(:, :, 4) = base_index + SIZE; index_ref(:, :, 4) = base_index;
                    index(:, :, 5) = base_index - 2 * SIZE; index_ref(:, :, 5) = index(:, :, 1);
                    index(:, :, 6) = base_index - SIZE - 1; index_ref(:, :, 6) = index(:, :, 1);
                    index(:, :, 7) = base_index - SIZE + 1; index_ref(:, :, 7) = index(:, :, 1);
                    index(:, :, 8) = base_index - 2; index_ref(:, :, 8) = index(:, :, 2);
                    index(:, :, 9) = base_index + 2; index_ref(:, :, 9) = index(:, :, 3);
                    index(:, :, 10) = base_index + SIZE - 1; index_ref(:, :, 10) = index(:, :, 4);
                    index(:, :, 11) = base_index + SIZE + 1; index_ref(:, :, 11) = index(:, :, 4);
                    index(:, :, 12) = base_index + 2 * SIZE; index_ref(:, :, 12) = index(:, :, 4);
                    index(:, :, 13) = base_index - 2 * SIZE - 1; index_ref(:, :, 13) = index(:, :, 5);
                    index(:, :, 14) = base_index - 2 * SIZE + 1; index_ref(:, :, 14) = index(:, :, 5);
                    index(:, :, 15) = base_index - SIZE - 2; index_ref(:, :, 15) = index(:, :, 6);
                    index(:, :, 16) = base_index - SIZE + 2; index_ref(:, :, 16) = index(:, :, 7);
                    index(:, :, 17) = base_index + SIZE - 2; index_ref(:, :, 17) = index(:, :, 10);
                    index(:, :, 18) = base_index + SIZE + 2; index_ref(:, :, 18) = index(:, :, 11);
                    index(:, :, 19) = base_index + 2 * SIZE - 1; index_ref(:, :, 19) = index(:, :, 12);
                    index(:, :, 20) = base_index + 2 * SIZE + 1; index_ref(:, :, 20) = index(:, :, 12);
                    index(:, :, 21) = base_index - 2 * SIZE - 2; index_ref(:, :, 21) = index(:, :, 13);
                    index(:, :, 22) = base_index - 2 * SIZE + 2; index_ref(:, :, 22) = index(:, :, 14);
                    index(:, :, 23) = base_index + 2 * SIZE - 2; index_ref(:, :, 23) = index(:, :, 19);
                    index(:, :, 24) = base_index + 2 * SIZE + 2; index_ref(:, :, 24) = index(:, :, 20);
                case 7
                    index(:, :, 1) = base_index - SIZE + 2; index_ref(:, :, 1) = base_index;
                    index(:, :, 2) = base_index - 1; index_ref(:, :, 2) = base_index;
                    index(:, :, 3) = base_index + 1; index_ref(:, :, 3) = base_index;
                    index(:, :, 4) = base_index + SIZE - 2; index_ref(:, :, 4) = base_index;
                    index(:, :, 5) = base_index - 2 * SIZE + 4; index_ref(:, :, 5) = index(:, :, 1);
                    index(2, :, 5) = index(2, :, 5) + 4 * SIZE - 3;
                    index(:, :, 6) = base_index - SIZE + 1; index_ref(:, :, 6) = index(:, :, 2);
                    index(:, :, 7) = base_index - SIZE + 3; index_ref(:, :, 7) = index(:, :, 3);
                    index(2, :, 7) = index(2, :, 7) + 2 * SIZE - 1;
                    index(:, :, 8) = base_index - 2; index_ref(:, :, 8) = index(:, :, 2);
                    index(:, :, 9) = base_index + 2; index_ref(:, :, 9) = index(:, :, 3);
                    index(:, :, 10) = base_index + SIZE - 3; index_ref(:, :, 10) = index(:, :, 2);
                    index(1, :, 10) = index(1, :, 10) - 2 * SIZE + 1;
                    index(:, :, 11) = base_index + SIZE - 1; index_ref(:, :, 11) = index(:, :, 3);
                    index(:, :, 12) = base_index + 2 * SIZE - 4; index_ref(:, :, 12) = index(:, :, 4);
                    index(1, :, 12) = index(1, :, 12) - 4 * SIZE + 3;
                    index(:, :, 13) = base_index - 2 * SIZE + 3; index_ref(:, :, 13) = index(:, :, 6);
                    index(2, :, 13) = index(2, :, 13) + 4 * SIZE - 1;
                    index(:, :, 14) = base_index - 2 * SIZE + 5; index_ref(:, :, 14) = index(:, :, 7);
                    index(2, :, 14) = index(2, :, 14) + 4 * SIZE - 5;
                    index(:, :, 15) = base_index - SIZE; index_ref(:, :, 15) = index(:, :, 8);
                    index(:, :, 16) = base_index - SIZE + 4; index_ref(:, :, 16) = index(:, :, 9);
                    index(2, :, 16) = index(2, :, 16) + 2 * SIZE - 3;
                    index(:, :, 17) = base_index + SIZE - 4; index_ref(:, :, 17) = index(:, :, 8);
                    index(1, :, 17) = index(1, :, 17) - 2 * SIZE + 3;
                    index(:, :, 18) = base_index + SIZE; index_ref(:, :, 18) = index(:, :, 9);
                    index(:, :, 19) = base_index + 2 * SIZE - 5; index_ref(:, :, 19) = index(:, :, 10);
                    index(1, :, 19) = index(1, :, 19) - 4 * SIZE + 5;
                    index(:, :, 20) = base_index + 2 * SIZE - 3; index_ref(:, :, 20) = index(:, :, 11);
                    index(1, :, 20) = index(1, :, 20) - 4 * SIZE + 1;
                    index(:, :, 21) = base_index - 2 * SIZE + 2; index_ref(:, :, 21) = index(:, :, 15);
                    index(:, :, 22) = base_index - 2 * SIZE + 6; index_ref(:, :, 22) = index(:, :, 16);
                    index(2, :, 22) = index(2, :, 22) + 4 * SIZE - 7;
                    index(:, :, 23) = base_index + 2 * SIZE - 6; index_ref(:, :, 23) = index(:, :, 17);
                    index(1, :, 23) = index(1, :, 23) - 4 * SIZE + 7;
                    index(:, :, 24) = base_index + 2 * SIZE - 2; index_ref(:, :, 24) = index(:, :, 18);
                case 8
                    index(:, :, 1) = base_index - SIZE; index_ref(:, :, 1) = base_index;
                    index(:, :, 2) = base_index - SIZE + 1; index_ref(:, :, 2) = base_index;
                    index(:, :, 3) = base_index + SIZE - 1; index_ref(:, :, 3) = base_index;
                    index(:, :, 4) = base_index + SIZE; index_ref(:, :, 4) = base_index;
                    index(:, :, 5) = base_index - 2 * SIZE; index_ref(:, :, 5) = index(:, :, 1);
                    index(:, :, 6) = base_index - 2 * SIZE + 1; index_ref(:, :, 6) = index(:, :, 1);
                    index(:, :, 7) = base_index - 2 * SIZE + 2; index_ref(:, :, 7) = index(:, :, 2);
                    index(:, :, 8) = base_index - 1; index_ref(:, :, 8) = index(:, :, 1);
                    index(:, :, 9) = base_index + 1; index_ref(:, :, 9) = index(:, :, 4);
                    index(:, :, 10) = base_index + 2 * SIZE - 2; index_ref(:, :, 10) = index(:, :, 3);
                    index(:, :, 11) = base_index + 2 * SIZE - 1; index_ref(:, :, 11) = index(:, :, 4);
                    index(:, :, 12) = base_index + 2 * SIZE; index_ref(:, :, 12) = index(:, :, 4);
                    index(:, :, 13) = base_index - 3 * SIZE + 1; index_ref(:, :, 13) = index(:, :, 5);
                    index(:, 1, 13) = index(:, 1, 13) + SIZE - 2;
                    index(:, :, 14) = base_index - 3 * SIZE + 2; index_ref(:, :, 14) = index(:, :, 6);
                    index(:, 1, 14) = index(:, 1, 14) + SIZE - 4;
                    index(:, :, 15) = base_index - SIZE - 1; index_ref(:, :, 15) = index(:, :, 5);
                    index(:, :, 16) = base_index - SIZE + 2; index_ref(:, :, 16) = index(:, :, 9);
                    index(:, :, 17) = base_index + SIZE - 2; index_ref(:, :, 17) = index(:, :, 8);
                    index(:, :, 18) = base_index + SIZE + 1; index_ref(:, :, 18) = index(:, :, 12);
                    index(:, :, 19) = base_index + 3 * SIZE - 2; index_ref(:, :, 19) = index(:, :, 11);
                    index(:, 2, 19) = index(:, 2, 19) - SIZE + 4;
                    index(:, :, 20) = base_index + 3 * SIZE - 1; index_ref(:, :, 20) = index(:, :, 12);
                    index(:, 2, 20) = index(:, 2, 20) - SIZE + 2;
                    index(:, :, 21) = base_index - 4 * SIZE + 2; index_ref(:, :, 21) = index(:, :, 13);
                    index(:, 1, 21) = index(:, 1, 21) + 3 * SIZE - 4;
                    index(:, :, 22) = base_index - 2; index_ref(:, :, 22) = index(:, :, 15);
                    index(:, :, 23) = base_index + 2; index_ref(:, :, 23) = index(:, :, 18);
                    index(:, :, 24) = base_index + 4 * SIZE - 2; index_ref(:, :, 24) = index(:, :, 20);
                    index(:, 2, 24) = index(:, 2, 24) - 3 * SIZE + 4;
                case 9
                    index(:, :, 1) = base_index - SIZE + 1; index_ref(:, :, 1) = base_index;
                    index(:, :, 2) = base_index - 1; index_ref(:, :, 2) = base_index;
                    index(:, :, 3) = base_index + 1; index_ref(:, :, 3) = base_index;
                    index(:, :, 4) = base_index + SIZE - 1; index_ref(:, :, 4) = base_index;
                    index(:, :, 5) = base_index - 2 * SIZE + 2; index_ref(:, :, 5) = index(:, :, 1);
                    index(:, :, 6) = base_index - SIZE; index_ref(:, :, 6) = index(:, :, 2);
                    index(:, :, 7) = base_index - SIZE + 2; index_ref(:, :, 7) = index(:, :, 3);
                    index(:, :, 8) = base_index - 2; index_ref(:, :, 8) = index(:, :, 2);
                    index(:, :, 9) = base_index + 2; index_ref(:, :, 9) = index(:, :, 3);
                    index(:, :, 10) = base_index + SIZE - 2; index_ref(:, :, 10) = index(:, :, 2);
                    index(:, :, 11) = base_index + SIZE; index_ref(:, :, 11) = index(:, :, 3);
                    index(:, :, 12) = base_index + 2 * SIZE - 2; index_ref(:, :, 12) = index(:, :, 4);
                    index(:, :, 13) = base_index - 2 * SIZE + 1; index_ref(:, :, 13) = index(:, :, 6);
                    index(:, :, 14) = base_index - 2 * SIZE + 3; index_ref(:, :, 14) = index(:, :, 7);
                    index(2, :, 14) = index(2, :, 14) + 4 * SIZE - 1;
                    index(:, :, 15) = base_index - SIZE - 1; index_ref(:, :, 15) = index(:, :, 8);
                    index(:, :, 16) = base_index - SIZE + 3; index_ref(:, :, 16) = index(:, :, 9);
                    index(2, :, 16) = index(2, :, 16) + 2 * SIZE - 1;
                    index(:, :, 17) = base_index + SIZE - 3; index_ref(:, :, 17) = index(:, :, 8);
                    index(1, :, 17) = index(1, :, 17) - 2 * SIZE + 1;
                    index(:, :, 18) = base_index + SIZE + 1; index_ref(:, :, 18) = index(:, :, 9);
                    index(:, :, 19) = base_index + 2 * SIZE - 3; index_ref(:, :, 19) = index(:, :, 10);
                    index(1, :, 19) = index(1, :, 19) - 4 * SIZE + 1;
                    index(:, :, 20) = base_index + 2 * SIZE - 1; index_ref(:, :, 20) = index(:, :, 11);
                    index(:, :, 21) = base_index - 2 * SIZE; index_ref(:, :, 21) = index(:, :, 15);
                    index(:, :, 22) = base_index - 2 * SIZE + 4; index_ref(:, :, 22) = index(:, :, 16);
                    index(2, :, 22) = index(2, :, 22) + 4 * SIZE - 3;
                    index(:, :, 23) = base_index + 2 * SIZE - 4; index_ref(:, :, 23) = index(:, :, 17);
                    index(1, :, 23) = index(1, :, 23) - 4 * SIZE + 3;
                    index(:, :, 24) = base_index + 2 * SIZE; index_ref(:, :, 24) = index(:, :, 18);
                case 10
                    index(:, :, 1) = base_index - 2 * SIZE + 1; index_ref(:, :, 1) = base_index;
                    index(:, :, 2) = base_index - SIZE; index_ref(:, :, 2) = base_index;
                    index(:, :, 3) = base_index + SIZE; index_ref(:, :, 3) = base_index;
                    index(:, :, 4) = base_index + 2 * SIZE - 1; index_ref(:, :, 4) = base_index;
                    index(:, :, 5) = base_index - 4 * SIZE + 2; index_ref(:, :, 5) = index(:, :, 1);
                    index(:, 1, 5) = index(:, 1, 5) + 3 * SIZE - 4;
                    index(:, :, 6) = base_index - 3 * SIZE + 1; index_ref(:, :, 6) = index(:, :, 2);
                    index(:, 1, 6) = index(:, 1, 6) + SIZE - 2;
                    index(:, :, 7) = base_index - 2 * SIZE; index_ref(:, :, 7) = index(:, :, 2);
                    index(:, :, 8) = base_index - SIZE + 1; index_ref(:, :, 8) = index(:, :, 3);
                    index(:, :, 9) = base_index + SIZE - 1; index_ref(:, :, 9) = index(:, :, 2);
                    index(:, :, 10) = base_index + 2 * SIZE; index_ref(:, :, 10) = index(:, :, 3);
                    index(:, :, 11) = base_index + 3 * SIZE - 1; index_ref(:, :, 11) = index(:, :, 3);
                    index(:, 2, 11) = index(:, 2, 11) - SIZE + 2;
                    index(:, :, 12) = base_index + 4 * SIZE - 2; index_ref(:, :, 12) = index(:, :, 4);
                    index(:, 2, 12) = index(:, 2, 12) - 3 * SIZE + 4;
                    index(:, :, 13) = base_index - 5 * SIZE + 2; index_ref(:, :, 13) = index(:, :, 6);
                    index(:, 1, 13) = index(:, 1, 13) + 5 * SIZE - 4;
                    index(:, :, 14) = base_index - 4 * SIZE + 1; index_ref(:, :, 14) = index(:, :, 7);
                    index(:, 1, 14) = index(:, 1, 14) + 3 * SIZE - 2;
                    index(:, :, 15) = base_index - 3 * SIZE + 2; index_ref(:, :, 15) = index(:, :, 8);
                    index(:, 1, 15) = index(:, 1, 15) + SIZE - 4;
                    index(:, :, 16) = base_index - 1; index_ref(:, :, 16) = index(:, :, 7);
                    index(:, :, 17) = base_index + 1; index_ref(:, :, 17) = index(:, :, 10);
                    index(:, :, 18) = base_index + 3 * SIZE - 2; index_ref(:, :, 18) = index(:, :, 9);
                    index(:, 2, 18) = index(:, 2, 18) - SIZE + 4;
                    index(:, :, 19) = base_index + 4 * SIZE - 1; index_ref(:, :, 19) = index(:, :, 10);
                    index(:, 2, 19) = index(:, 2, 19) - 3 * SIZE + 2;
                    index(:, :, 20) = base_index + 5 * SIZE - 2; index_ref(:, :, 20) = index(:, :, 11);
                    index(:, 2, 20) = index(:, 2, 20) - 5 * SIZE + 4;
                    index(:, :, 21) = base_index - 6 * SIZE + 2; index_ref(:, :, 21) = index(:, :, 14);
                    index(:, 1, 21) = index(:, 1, 21) + 7 * SIZE - 4;
                    index(:, :, 22) = base_index - 2 * SIZE + 2; index_ref(:, :, 22) = index(:, :, 17);
                    index(:, :, 23) = base_index + 2 * SIZE - 2; index_ref(:, :, 23) = index(:, :, 16);
                    index(:, :, 24) = base_index + 6 * SIZE - 2; index_ref(:, :, 24) = index(:, :, 19);
                    index(:, 2, 24) = index(:, 2, 24) - 7 * SIZE + 4;
            end

        case 5
            base_index = [13];
            index = zeros(1, 1, 24);
            index_ref = index;
            b4_enc_fixval = zeros(1, 1, 24);
            switch mode
                case 1
                    index(:, :, 1) = base_index - SIZE; index_ref(:, :, 1) = base_index;
                    index(:, :, 2) = base_index - 1; index_ref(:, :, 2) = base_index;
                    index(:, :, 3) = base_index + 1; index_ref(:, :, 3) = base_index;
                    index(:, :, 4) = base_index + SIZE; index_ref(:, :, 4) = base_index;
                    index(:, :, 5) = base_index - 2 * SIZE; index_ref(:, :, 5) = index(:, :, 1);
                    index(:, :, 6) = base_index - SIZE - 1; index_ref(:, :, 6) = index(:, :, 2);
                    index(:, :, 7) = base_index - SIZE + 1; index_ref(:, :, 7) = index(:, :, 3);
                    index(:, :, 8) = base_index - 2; index_ref(:, :, 8) = index(:, :, 2);
                    index(:, :, 9) = base_index + 2; index_ref(:, :, 9) = index(:, :, 3);
                    index(:, :, 10) = base_index + SIZE - 1; index_ref(:, :, 10) = index(:, :, 2);
                    index(:, :, 11) = base_index + SIZE + 1; index_ref(:, :, 11) = index(:, :, 3);
                    index(:, :, 12) = base_index + 2 * SIZE; index_ref(:, :, 12) = index(:, :, 4);
                    index(:, :, 13) = base_index - 2 * SIZE - 1; index_ref(:, :, 13) = index(:, :, 6);
                    index(:, :, 14) = base_index - 2 * SIZE + 1; index_ref(:, :, 14) = index(:, :, 7);
                    index(:, :, 15) = base_index - SIZE - 2; index_ref(:, :, 15) = index(:, :, 8);
                    index(:, :, 16) = base_index - SIZE + 2; index_ref(:, :, 16) = index(:, :, 9);
                    index(:, :, 17) = base_index + SIZE - 2; index_ref(:, :, 17) = index(:, :, 8);
                    index(:, :, 18) = base_index + SIZE + 2; index_ref(:, :, 18) = index(:, :, 9);
                    index(:, :, 19) = base_index + 2 * SIZE - 1; index_ref(:, :, 19) = index(:, :, 10);
                    index(:, :, 20) = base_index + 2 * SIZE + 1; index_ref(:, :, 20) = index(:, :, 11);
                    index(:, :, 21) = base_index - 2 * SIZE - 2; index_ref(:, :, 21) = index(:, :, 15);
                    index(:, :, 22) = base_index - 2 * SIZE + 2; index_ref(:, :, 22) = index(:, :, 16);
                    index(:, :, 23) = base_index + 2 * SIZE - 2; index_ref(:, :, 23) = index(:, :, 17);
                    index(:, :, 24) = base_index + 2 * SIZE + 2; index_ref(:, :, 24) = index(:, :, 18);
                case 2
                    index(:, :, 1) = base_index - 2 * SIZE - 1; index_ref(:, :, 1) = base_index;
                    index(:, :, 2) = base_index - SIZE; index_ref(:, :, 2) = base_index;
                    index(:, :, 3) = base_index + SIZE; index_ref(:, :, 3) = base_index;
                    index(:, :, 4) = base_index + 2 * SIZE + 1; index_ref(:, :, 4) = base_index;
                    index(:, :, 5) = base_index - 4 * SIZE - 2; index_ref(:, :, 5) = index(:, :, 1);
                    index(:, 1, 5) = index(:, 1, 5) + 3 * SIZE + 4;
                    index(:, :, 6) = base_index - 3 * SIZE - 1; index_ref(:, :, 6) = index(:, :, 2);
                    index(:, 1, 6) = index(:, 1, 6) + SIZE + 2;
                    index(:, :, 7) = base_index - 2 * SIZE; index_ref(:, :, 7) = index(:, :, 2);
                    index(:, :, 8) = base_index - SIZE - 1; index_ref(:, :, 8) = index(:, :, 3);
                    index(:, :, 9) = base_index + SIZE + 1; index_ref(:, :, 9) = index(:, :, 2);
                    index(:, :, 10) = base_index + 2 * SIZE; index_ref(:, :, 10) = index(:, :, 3);
                    index(:, :, 11) = base_index + 3 * SIZE + 1; index_ref(:, :, 11) = index(:, :, 3);
                    index(:, 1, 11) = index(:, 1, 11) - SIZE - 2;
                    index(:, :, 12) = base_index + 4 * SIZE + 2; index_ref(:, :, 12) = index(:, :, 4);
                    index(:, 1, 12) = index(:, 1, 12) - 3 * SIZE - 4;
                    index(:, :, 13) = base_index - 5 * SIZE - 2; index_ref(:, :, 13) = index(:, :, 6);
                    index(:, 1, 13) = index(:, 1, 13) + 5 * SIZE + 4;
                    index(:, :, 14) = base_index - 4 * SIZE - 1; index_ref(:, :, 14) = index(:, :, 7);
                    index(:, 1, 14) = index(:, 1, 14) + 3 * SIZE + 2;
                    index(:, :, 15) = base_index - 3 * SIZE - 2; index_ref(:, :, 15) = index(:, :, 8);
                    index(:, 1, 15) = index(:, 1, 15) + SIZE + 4;
                    index(:, :, 16) = base_index - 1; index_ref(:, :, 16) = index(:, :, 10);
                    index(:, :, 17) = base_index + 1; index_ref(:, :, 17) = index(:, :, 7);
                    index(:, :, 18) = base_index + 3 * SIZE + 2; index_ref(:, :, 18) = index(:, :, 9);
                    index(:, 1, 18) = index(:, 1, 18) - SIZE - 4;
                    index(:, :, 19) = base_index + 4 * SIZE + 1; index_ref(:, :, 19) = index(:, :, 10);
                    index(:, 1, 19) = index(:, 1, 19) - 3 * SIZE - 2;
                    index(:, :, 20) = base_index + 5 * SIZE + 2; index_ref(:, :, 20) = index(:, :, 11);
                    index(:, 1, 20) = index(:, 1, 20) - 5 * SIZE - 4;
                    index(:, :, 21) = base_index - 6 * SIZE - 2; index_ref(:, :, 21) = index(:, :, 14);
                    index(:, 1, 21) = index(:, 1, 21) + 7 * SIZE + 4;
                    index(:, :, 22) = base_index - 2 * SIZE - 2; index_ref(:, :, 22) = index(:, :, 16);
                    index(:, :, 23) = base_index + 2 * SIZE + 2; index_ref(:, :, 23) = index(:, :, 17);
                    index(:, :, 24) = base_index + 6 * SIZE + 2; index_ref(:, :, 24) = index(:, :, 19);
                    index(:, 1, 24) = index(:, 1, 24) - 7 * SIZE - 4;
                case 3
                    index(:, :, 1) = base_index - SIZE - 1; index_ref(:, :, 1) = base_index;
                    index(:, :, 2) = base_index - SIZE; index_ref(:, :, 2) = base_index;
                    index(:, :, 3) = base_index + SIZE; index_ref(:, :, 3) = base_index;
                    index(:, :, 4) = base_index + SIZE + 1; index_ref(:, :, 4) = base_index;
                    index(:, :, 5) = base_index - 2 * SIZE - 2; index_ref(:, :, 5) = index(:, :, 1);
                    index(:, :, 6) = base_index - 2 * SIZE - 1; index_ref(:, :, 6) = index(:, :, 2);
                    index(:, :, 7) = base_index - 2 * SIZE; index_ref(:, :, 7) = index(:, :, 2);
                    index(:, :, 8) = base_index - 1; index_ref(:, :, 8) = index(:, :, 3);
                    index(:, :, 9) = base_index + 1; index_ref(:, :, 9) = index(:, :, 2);
                    index(:, :, 10) = base_index + 2 * SIZE; index_ref(:, :, 10) = index(:, :, 3);
                    index(:, :, 11) = base_index + 2 * SIZE + 1; index_ref(:, :, 11) = index(:, :, 3);
                    index(:, :, 12) = base_index + 2 * SIZE + 2; index_ref(:, :, 12) = index(:, :, 4);
                    index(:, :, 13) = base_index - 3 * SIZE - 2; index_ref(:, :, 13) = index(:, :, 6);
                    index(:, 1, 13) = index(:, 1, 13) + SIZE + 4;
                    index(:, :, 14) = base_index - 3 * SIZE - 1; index_ref(:, :, 14) = index(:, :, 7);
                    index(:, 1, 14) = index(:, 1, 14) + SIZE + 2;
                    index(:, :, 15) = base_index - SIZE - 2; index_ref(:, :, 15) = index(:, :, 8);
                    index(:, :, 16) = base_index - SIZE + 1; index_ref(:, :, 16) = index(:, :, 7);
                    index(:, :, 17) = base_index + SIZE - 1; index_ref(:, :, 17) = index(:, :, 10);
                    index(:, :, 18) = base_index + SIZE + 2; index_ref(:, :, 18) = index(:, :, 9);
                    index(:, :, 19) = base_index + 3 * SIZE + 1; index_ref(:, :, 19) = index(:, :, 10);
                    index(:, 1, 19) = index(:, 1, 19) - SIZE - 2;
                    index(:, :, 20) = base_index + 3 * SIZE + 2; index_ref(:, :, 20) = index(:, :, 11);
                    index(:, 1, 20) = index(:, 1, 20) - SIZE - 4;
                    index(:, :, 21) = base_index - 4 * SIZE - 2; index_ref(:, :, 21) = index(:, :, 14);
                    index(:, 1, 21) = index(:, 1, 21) + 3 * SIZE + 4;
                    index(:, :, 22) = base_index - 2; index_ref(:, :, 22) = index(:, :, 17);
                    index(:, :, 23) = base_index + 2; index_ref(:, :, 23) = index(:, :, 16);
                    index(:, :, 24) = base_index + 4 * SIZE + 2; index_ref(:, :, 24) = index(:, :, 19);
                    index(:, 1, 24) = index(:, 1, 24) - 3 * SIZE - 4;
                case 4
                    index(:, :, 1) = base_index - SIZE - 1; index_ref(:, :, 1) = base_index;
                    index(:, :, 2) = base_index - 1; index_ref(:, :, 2) = base_index;
                    index(:, :, 3) = base_index + 1; index_ref(:, :, 3) = base_index;
                    index(:, :, 4) = base_index + SIZE + 1; index_ref(:, :, 4) = base_index;
                    index(:, :, 5) = base_index - 2 * SIZE - 2; index_ref(:, :, 5) = index(:, :, 1);
                    index(:, :, 6) = base_index - SIZE - 2; index_ref(:, :, 6) = index(:, :, 2);
                    index(:, :, 7) = base_index - SIZE; index_ref(:, :, 7) = index(:, :, 3);
                    index(:, :, 8) = base_index - 2; index_ref(:, :, 8) = index(:, :, 2);
                    index(:, :, 9) = base_index + 2; index_ref(:, :, 9) = index(:, :, 3);
                    index(:, :, 10) = base_index + SIZE; index_ref(:, :, 10) = index(:, :, 2);
                    index(:, :, 11) = base_index + SIZE + 2; index_ref(:, :, 11) = index(:, :, 3);
                    index(:, :, 12) = base_index + 2 * SIZE + 2; index_ref(:, :, 12) = index(:, :, 4);
                    index(:, :, 13) = base_index - 2 * SIZE - 3; index_ref(:, :, 13) = index(:, :, 6);
                    index(1, :, 13) = index(1, :, 13) + 4 * SIZE + 1;
                    index(:, :, 14) = base_index - 2 * SIZE - 1; index_ref(:, :, 14) = index(:, :, 7);
                    index(:, :, 15) = base_index - SIZE - 3; index_ref(:, :, 15) = index(:, :, 8);
                    index(1, :, 15) = index(1, :, 15) + 2 * SIZE + 1;
                    index(:, :, 16) = base_index - SIZE + 1; index_ref(:, :, 16) = index(:, :, 9);
                    index(:, :, 17) = base_index + SIZE - 1; index_ref(:, :, 17) = index(:, :, 8);
                    index(:, :, 18) = base_index + SIZE + 3; index_ref(:, :, 18) = index(:, :, 9);
                    index(1, :, 18) = index(1, :, 18) - 2 * SIZE - 1;
                    index(:, :, 19) = base_index + 2 * SIZE + 1; index_ref(:, :, 19) = index(:, :, 10);
                    index(:, :, 20) = base_index + 2 * SIZE + 3; index_ref(:, :, 20) = index(:, :, 11);
                    index(1, :, 20) = index(1, :, 20) - 4 * SIZE - 1;
                    index(:, :, 21) = base_index - 2 * SIZE - 4; index_ref(:, :, 21) = index(:, :, 15);
                    index(1, :, 21) = index(1, :, 21) + 4 * SIZE + 3;
                    index(:, :, 22) = base_index - 2 * SIZE; index_ref(:, :, 22) = index(:, :, 16);
                    index(:, :, 23) = base_index + 2 * SIZE; index_ref(:, :, 23) = index(:, :, 17);
                    index(:, :, 24) = base_index + 2 * SIZE + 4; index_ref(:, :, 24) = index(:, :, 18);
                    index(1, :, 24) = index(1, :, 24) - 4 * SIZE - 3;
                case 5
                    index(:, :, 1) = base_index - SIZE - 2; index_ref(:, :, 1) = base_index;
                    index(:, :, 2) = base_index - 1; index_ref(:, :, 2) = base_index;
                    index(:, :, 3) = base_index + 1; index_ref(:, :, 3) = base_index;
                    index(:, :, 4) = base_index + SIZE + 2; index_ref(:, :, 4) = base_index;
                    index(:, :, 5) = base_index - 2 * SIZE - 4; index_ref(:, :, 5) = index(:, :, 1);
                    index(1, :, 5) = index(1, :, 5) + 4 * SIZE + 3;
                    index(:, :, 6) = base_index - SIZE - 3; index_ref(:, :, 6) = index(:, :, 2);
                    index(1, :, 6) = index(1, :, 6) + 2 * SIZE + 1;
                    index(:, :, 7) = base_index - SIZE - 1; index_ref(:, :, 7) = index(:, :, 3);
                    index(:, :, 8) = base_index - 2; index_ref(:, :, 8) = index(:, :, 2);
                    index(:, :, 9) = base_index + 2; index_ref(:, :, 9) = index(:, :, 3);
                    index(:, :, 10) = base_index + SIZE + 1; index_ref(:, :, 10) = index(:, :, 2);
                    index(:, :, 11) = base_index + SIZE + 3; index_ref(:, :, 11) = index(:, :, 3);
                    index(1, :, 11) = index(1, :, 11) - 2 * SIZE - 1;
                    index(:, :, 12) = base_index + 2 * SIZE + 4; index_ref(:, :, 12) = index(:, :, 4);
                    index(1, :, 12) = index(1, :, 12) - 4 * SIZE - 3;
                    index(:, :, 13) = base_index - 2 * SIZE - 5; index_ref(:, :, 13) = index(:, :, 6);
                    index(1, :, 13) = index(1, :, 13) + 4 * SIZE + 5;
                    index(:, :, 14) = base_index - 2 * SIZE - 3; index_ref(:, :, 14) = index(:, :, 7);
                    index(1, :, 14) = index(1, :, 14) + 4 * SIZE + 1;
                    index(:, :, 15) = base_index - SIZE - 4; index_ref(:, :, 15) = index(:, :, 8);
                    index(1, :, 15) = index(1, :, 15) + 2 * SIZE + 3;
                    index(:, :, 16) = base_index - SIZE; index_ref(:, :, 16) = index(:, :, 9);
                    index(:, :, 17) = base_index + SIZE; index_ref(:, :, 17) = index(:, :, 8);
                    index(:, :, 18) = base_index + SIZE + 4; index_ref(:, :, 18) = index(:, :, 9);
                    index(1, :, 18) = index(1, :, 18) - 2 * SIZE - 3;
                    index(:, :, 19) = base_index + 2 * SIZE + 3; index_ref(:, :, 19) = index(:, :, 10);
                    index(1, :, 19) = index(1, :, 19) - 4 * SIZE - 1;
                    index(:, :, 20) = base_index + 2 * SIZE + 5; index_ref(:, :, 20) = index(:, :, 11);
                    index(1, :, 20) = index(1, :, 20) - 4 * SIZE - 5;
                    index(:, :, 21) = base_index - 2 * SIZE - 6; index_ref(:, :, 21) = index(:, :, 15);
                    index(1, :, 21) = index(1, :, 21) + 4 * SIZE + 7;
                    index(:, :, 22) = base_index - 2 * SIZE - 2; index_ref(:, :, 22) = index(:, :, 16);
                    index(:, :, 23) = base_index + 2 * SIZE + 2; index_ref(:, :, 23) = index(:, :, 17);
                    index(:, :, 24) = base_index + 2 * SIZE + 6; index_ref(:, :, 24) = index(:, :, 18);
                    index(1, :, 24) = index(1, :, 24) - 4 * SIZE - 7;
                case 6
                    index(:, :, 1) = base_index - SIZE; index_ref(:, :, 1) = base_index;
                    index(:, :, 2) = base_index - 1; index_ref(:, :, 2) = base_index;
                    index(:, :, 3) = base_index + 1; index_ref(:, :, 3) = base_index;
                    index(:, :, 4) = base_index + SIZE; index_ref(:, :, 4) = base_index;
                    index(:, :, 5) = base_index - 2 * SIZE; index_ref(:, :, 5) = index(:, :, 1);
                    index(:, :, 6) = base_index - SIZE - 1; index_ref(:, :, 6) = index(:, :, 1);
                    index(:, :, 7) = base_index - SIZE + 1; index_ref(:, :, 7) = index(:, :, 1);
                    index(:, :, 8) = base_index - 2; index_ref(:, :, 8) = index(:, :, 2);
                    index(:, :, 9) = base_index + 2; index_ref(:, :, 9) = index(:, :, 3);
                    index(:, :, 10) = base_index + SIZE - 1; index_ref(:, :, 10) = index(:, :, 4);
                    index(:, :, 11) = base_index + SIZE + 1; index_ref(:, :, 11) = index(:, :, 4);
                    index(:, :, 12) = base_index + 2 * SIZE; index_ref(:, :, 12) = index(:, :, 4);
                    index(:, :, 13) = base_index - 2 * SIZE - 1; index_ref(:, :, 13) = index(:, :, 5);
                    index(:, :, 14) = base_index - 2 * SIZE + 1; index_ref(:, :, 14) = index(:, :, 5);
                    index(:, :, 15) = base_index - SIZE - 2; index_ref(:, :, 15) = index(:, :, 6);
                    index(:, :, 16) = base_index - SIZE + 2; index_ref(:, :, 16) = index(:, :, 7);
                    index(:, :, 17) = base_index + SIZE - 2; index_ref(:, :, 17) = index(:, :, 10);
                    index(:, :, 18) = base_index + SIZE + 2; index_ref(:, :, 18) = index(:, :, 11);
                    index(:, :, 19) = base_index + 2 * SIZE - 1; index_ref(:, :, 19) = index(:, :, 12);
                    index(:, :, 20) = base_index + 2 * SIZE + 1; index_ref(:, :, 20) = index(:, :, 12);
                    index(:, :, 21) = base_index - 2 * SIZE - 2; index_ref(:, :, 21) = index(:, :, 13);
                    index(:, :, 22) = base_index - 2 * SIZE + 2; index_ref(:, :, 22) = index(:, :, 14);
                    index(:, :, 23) = base_index + 2 * SIZE - 2; index_ref(:, :, 23) = index(:, :, 19);
                    index(:, :, 24) = base_index + 2 * SIZE + 2; index_ref(:, :, 24) = index(:, :, 20);
                case 7
                    index(:, :, 1) = base_index - SIZE + 2; index_ref(:, :, 1) = base_index;
                    index(:, :, 2) = base_index - 1; index_ref(:, :, 2) = base_index;
                    index(:, :, 3) = base_index + 1; index_ref(:, :, 3) = base_index;
                    index(:, :, 4) = base_index + SIZE - 2; index_ref(:, :, 4) = base_index;
                    index(:, :, 5) = base_index - 2 * SIZE + 4; index_ref(:, :, 5) = index(:, :, 1);
                    index(1, :, 5) = index(1, :, 5) + 4 * SIZE - 3;
                    index(:, :, 6) = base_index - SIZE + 1; index_ref(:, :, 6) = index(:, :, 2);
                    index(:, :, 7) = base_index - SIZE + 3; index_ref(:, :, 7) = index(:, :, 3);
                    index(1, :, 7) = index(1, :, 7) + 2 * SIZE - 1;
                    index(:, :, 8) = base_index - 2; index_ref(:, :, 8) = index(:, :, 2);
                    index(:, :, 9) = base_index + 2; index_ref(:, :, 9) = index(:, :, 3);
                    index(:, :, 10) = base_index + SIZE - 3; index_ref(:, :, 10) = index(:, :, 2);
                    index(1, :, 10) = index(1, :, 10) - 2 * SIZE + 1;
                    index(:, :, 11) = base_index + SIZE - 1; index_ref(:, :, 11) = index(:, :, 3);
                    index(:, :, 12) = base_index + 2 * SIZE - 4; index_ref(:, :, 12) = index(:, :, 4);
                    index(1, :, 12) = index(1, :, 12) - 4 * SIZE + 3;
                    index(:, :, 13) = base_index - 2 * SIZE + 3; index_ref(:, :, 13) = index(:, :, 6);
                    index(1, :, 13) = index(1, :, 13) + 4 * SIZE - 1;
                    index(:, :, 14) = base_index - 2 * SIZE + 5; index_ref(:, :, 14) = index(:, :, 7);
                    index(1, :, 14) = index(1, :, 14) + 4 * SIZE - 5;
                    index(:, :, 15) = base_index - SIZE; index_ref(:, :, 15) = index(:, :, 8);
                    index(:, :, 16) = base_index - SIZE + 4; index_ref(:, :, 16) = index(:, :, 9);
                    index(1, :, 16) = index(1, :, 16) + 2 * SIZE - 3;
                    index(:, :, 17) = base_index + SIZE - 4; index_ref(:, :, 17) = index(:, :, 8);
                    index(1, :, 17) = index(1, :, 17) - 2 * SIZE + 3;
                    index(:, :, 18) = base_index + SIZE; index_ref(:, :, 18) = index(:, :, 9);
                    index(:, :, 19) = base_index + 2 * SIZE - 5; index_ref(:, :, 19) = index(:, :, 10);
                    index(1, :, 19) = index(1, :, 19) - 4 * SIZE + 5;
                    index(:, :, 20) = base_index + 2 * SIZE - 3; index_ref(:, :, 20) = index(:, :, 11);
                    index(1, :, 20) = index(1, :, 20) - 4 * SIZE + 1;
                    index(:, :, 21) = base_index - 2 * SIZE + 2; index_ref(:, :, 21) = index(:, :, 15);
                    index(:, :, 22) = base_index - 2 * SIZE + 6; index_ref(:, :, 22) = index(:, :, 16);
                    index(1, :, 22) = index(1, :, 22) + 4 * SIZE - 7;
                    index(:, :, 23) = base_index + 2 * SIZE - 6; index_ref(:, :, 23) = index(:, :, 17);
                    index(1, :, 23) = index(1, :, 23) - 4 * SIZE + 7;
                    index(:, :, 24) = base_index + 2 * SIZE - 2; index_ref(:, :, 24) = index(:, :, 18);
                case 8
                    index(:, :, 1) = base_index - SIZE; index_ref(:, :, 1) = base_index;
                    index(:, :, 2) = base_index - SIZE + 1; index_ref(:, :, 2) = base_index;
                    index(:, :, 3) = base_index + SIZE - 1; index_ref(:, :, 3) = base_index;
                    index(:, :, 4) = base_index + SIZE; index_ref(:, :, 4) = base_index;
                    index(:, :, 5) = base_index - 2 * SIZE; index_ref(:, :, 5) = index(:, :, 1);
                    index(:, :, 6) = base_index - 2 * SIZE + 1; index_ref(:, :, 6) = index(:, :, 1);
                    index(:, :, 7) = base_index - 2 * SIZE + 2; index_ref(:, :, 7) = index(:, :, 2);
                    index(:, :, 8) = base_index - 1; index_ref(:, :, 8) = index(:, :, 1);
                    index(:, :, 9) = base_index + 1; index_ref(:, :, 9) = index(:, :, 4);
                    index(:, :, 10) = base_index + 2 * SIZE - 2; index_ref(:, :, 10) = index(:, :, 3);
                    index(:, :, 11) = base_index + 2 * SIZE - 1; index_ref(:, :, 11) = index(:, :, 4);
                    index(:, :, 12) = base_index + 2 * SIZE; index_ref(:, :, 12) = index(:, :, 4);
                    index(:, :, 13) = base_index - 3 * SIZE + 1; index_ref(:, :, 13) = index(:, :, 5);
                    index(:, 1, 13) = index(:, 1, 13) + SIZE - 2;
                    index(:, :, 14) = base_index - 3 * SIZE + 2; index_ref(:, :, 14) = index(:, :, 6);
                    index(:, 1, 14) = index(:, 1, 14) + SIZE - 4;
                    index(:, :, 15) = base_index - SIZE - 1; index_ref(:, :, 15) = index(:, :, 5);
                    index(:, :, 16) = base_index - SIZE + 2; index_ref(:, :, 16) = index(:, :, 9);
                    index(:, :, 17) = base_index + SIZE - 2; index_ref(:, :, 17) = index(:, :, 8);
                    index(:, :, 18) = base_index + SIZE + 1; index_ref(:, :, 18) = index(:, :, 12);
                    index(:, :, 19) = base_index + 3 * SIZE - 2; index_ref(:, :, 19) = index(:, :, 11);
                    index(:, 1, 19) = index(:, 1, 19) - SIZE + 4;
                    index(:, :, 20) = base_index + 3 * SIZE - 1; index_ref(:, :, 20) = index(:, :, 12);
                    index(:, 1, 20) = index(:, 1, 20) - SIZE + 2;
                    index(:, :, 21) = base_index - 4 * SIZE + 2; index_ref(:, :, 21) = index(:, :, 13);
                    index(:, 1, 21) = index(:, 1, 21) + 3 * SIZE - 4;
                    index(:, :, 22) = base_index - 2; index_ref(:, :, 22) = index(:, :, 15);
                    index(:, :, 23) = base_index + 2; index_ref(:, :, 23) = index(:, :, 18);
                    index(:, :, 24) = base_index + 4 * SIZE - 2; index_ref(:, :, 24) = index(:, :, 20);
                    index(:, 1, 24) = index(:, 1, 24) - 3 * SIZE + 4;
                case 9
                    index(:, :, 1) = base_index - SIZE + 1; index_ref(:, :, 1) = base_index;
                    index(:, :, 2) = base_index - 1; index_ref(:, :, 2) = base_index;
                    index(:, :, 3) = base_index + 1; index_ref(:, :, 3) = base_index;
                    index(:, :, 4) = base_index + SIZE - 1; index_ref(:, :, 4) = base_index;
                    index(:, :, 5) = base_index - 2 * SIZE + 2; index_ref(:, :, 5) = index(:, :, 1);
                    index(:, :, 6) = base_index - SIZE; index_ref(:, :, 6) = index(:, :, 2);
                    index(:, :, 7) = base_index - SIZE + 2; index_ref(:, :, 7) = index(:, :, 3);
                    index(:, :, 8) = base_index - 2; index_ref(:, :, 8) = index(:, :, 2);
                    index(:, :, 9) = base_index + 2; index_ref(:, :, 9) = index(:, :, 3);
                    index(:, :, 10) = base_index + SIZE - 2; index_ref(:, :, 10) = index(:, :, 2);
                    index(:, :, 11) = base_index + SIZE; index_ref(:, :, 11) = index(:, :, 3);
                    index(:, :, 12) = base_index + 2 * SIZE - 2; index_ref(:, :, 12) = index(:, :, 4);
                    index(:, :, 13) = base_index - 2 * SIZE + 1; index_ref(:, :, 13) = index(:, :, 6);
                    index(:, :, 14) = base_index - 2 * SIZE + 3; index_ref(:, :, 14) = index(:, :, 7);
                    index(1, :, 14) = index(1, :, 14) + 4 * SIZE - 1;
                    index(:, :, 15) = base_index - SIZE - 1; index_ref(:, :, 15) = index(:, :, 8);
                    index(:, :, 16) = base_index - SIZE + 3; index_ref(:, :, 16) = index(:, :, 9);
                    index(1, :, 16) = index(1, :, 16) + 2 * SIZE - 1;
                    index(:, :, 17) = base_index + SIZE - 3; index_ref(:, :, 17) = index(:, :, 8);
                    index(1, :, 17) = index(1, :, 17) - 2 * SIZE + 1;
                    index(:, :, 18) = base_index + SIZE + 1; index_ref(:, :, 18) = index(:, :, 9);
                    index(:, :, 19) = base_index + 2 * SIZE - 3; index_ref(:, :, 19) = index(:, :, 10);
                    index(1, :, 19) = index(1, :, 19) - 4 * SIZE + 1;
                    index(:, :, 20) = base_index + 2 * SIZE - 1; index_ref(:, :, 20) = index(:, :, 11);
                    index(:, :, 21) = base_index - 2 * SIZE; index_ref(:, :, 21) = index(:, :, 15);
                    index(:, :, 22) = base_index - 2 * SIZE + 4; index_ref(:, :, 22) = index(:, :, 16);
                    index(1, :, 22) = index(1, :, 22) + 4 * SIZE - 3;
                    index(:, :, 23) = base_index + 2 * SIZE - 4; index_ref(:, :, 23) = index(:, :, 17);
                    index(1, :, 23) = index(1, :, 23) - 4 * SIZE + 3;
                    index(:, :, 24) = base_index + 2 * SIZE; index_ref(:, :, 24) = index(:, :, 18);
                case 10
                    index(:, :, 1) = base_index - 2 * SIZE + 1; index_ref(:, :, 1) = base_index;
                    index(:, :, 2) = base_index - SIZE; index_ref(:, :, 2) = base_index;
                    index(:, :, 3) = base_index + SIZE; index_ref(:, :, 3) = base_index;
                    index(:, :, 4) = base_index + 2 * SIZE - 1; index_ref(:, :, 4) = base_index;
                    index(:, :, 5) = base_index - 4 * SIZE + 2; index_ref(:, :, 5) = index(:, :, 1);
                    index(:, 1, 5) = index(:, 1, 5) + 3 * SIZE - 4;
                    index(:, :, 6) = base_index - 3 * SIZE + 1; index_ref(:, :, 6) = index(:, :, 2);
                    index(:, 1, 6) = index(:, 1, 6) + SIZE - 2;
                    index(:, :, 7) = base_index - 2 * SIZE; index_ref(:, :, 7) = index(:, :, 2);
                    index(:, :, 8) = base_index - SIZE + 1; index_ref(:, :, 8) = index(:, :, 3);
                    index(:, :, 9) = base_index + SIZE - 1; index_ref(:, :, 9) = index(:, :, 2);
                    index(:, :, 10) = base_index + 2 * SIZE; index_ref(:, :, 10) = index(:, :, 3);
                    index(:, :, 11) = base_index + 3 * SIZE - 1; index_ref(:, :, 11) = index(:, :, 3);
                    index(:, 1, 11) = index(:, 1, 11) - SIZE + 2;
                    index(:, :, 12) = base_index + 4 * SIZE - 2; index_ref(:, :, 12) = index(:, :, 4);
                    index(:, 1, 12) = index(:, 1, 12) - 3 * SIZE + 4;
                    index(:, :, 13) = base_index - 5 * SIZE + 2; index_ref(:, :, 13) = index(:, :, 6);
                    index(:, 1, 13) = index(:, 1, 13) + 5 * SIZE - 4;
                    index(:, :, 14) = base_index - 4 * SIZE + 1; index_ref(:, :, 14) = index(:, :, 7);
                    index(:, 1, 14) = index(:, 1, 14) + 3 * SIZE - 2;
                    index(:, :, 15) = base_index - 3 * SIZE + 2; index_ref(:, :, 15) = index(:, :, 8);
                    index(:, 1, 15) = index(:, 1, 15) + SIZE - 4;
                    index(:, :, 16) = base_index - 1; index_ref(:, :, 16) = index(:, :, 7);
                    index(:, :, 17) = base_index + 1; index_ref(:, :, 17) = index(:, :, 10);
                    index(:, :, 18) = base_index + 3 * SIZE - 2; index_ref(:, :, 18) = index(:, :, 9);
                    index(:, 1, 18) = index(:, 1, 18) - SIZE + 4;
                    index(:, :, 19) = base_index + 4 * SIZE - 1; index_ref(:, :, 19) = index(:, :, 10);
                    index(:, 1, 19) = index(:, 1, 19) - 3 * SIZE + 2;
                    index(:, :, 20) = base_index + 5 * SIZE - 2; index_ref(:, :, 20) = index(:, :, 11);
                    index(:, 1, 20) = index(:, 1, 20) - 5 * SIZE + 4;
                    index(:, :, 21) = base_index - 6 * SIZE + 2; index_ref(:, :, 21) = index(:, :, 14);
                    index(:, 1, 21) = index(:, 1, 21) + 7 * SIZE - 4;
                    index(:, :, 22) = base_index - 2 * SIZE + 2; index_ref(:, :, 22) = index(:, :, 17);
                    index(:, :, 23) = base_index + 2 * SIZE - 2; index_ref(:, :, 23) = index(:, :, 16);
                    index(:, :, 24) = base_index + 6 * SIZE - 2; index_ref(:, :, 24) = index(:, :, 19);
                    index(:, 1, 24) = index(:, 1, 24) - 7 * SIZE + 4;
            end
    end

    [~, ~, pre_cnt] = size(index);
    for i = 1:pre_cnt
        pre_ind = index(:, :, i);
        ref_ind = index_ref(:, :, i);
        fixed_src(pre_ind) = fixed_src(ref_ind);
        fixval = dst(pre_ind) - fixed_src(pre_ind);

        b4_enc_fixval(:, :, i) = round(fixval ./ TH_fix);
        dec_fixval = round(b4_enc_fixval(:, :, i) .* TH_fix);
        % dct_fixval = dct2(fixval);
        % b4_enc_fixval(:, :, i) = quantize_fixval(dct_fixval, color_num, Q_fix);
        % deQ_temp = dequantize_fixval(b4_enc_fixval(:, :, i), color_num, Q_fix);
        % dec_fixval = round(idct2(deQ_temp));

        fixed_src(pre_ind) = fixed_src(pre_ind) + dec_fixval;
    end

    MAE = mean(abs(dst - fixed_src), [1, 2]);
    fix_cnt = sum(b4_enc_fixval ~= 0, [1, 2, 3]); % 12
end
